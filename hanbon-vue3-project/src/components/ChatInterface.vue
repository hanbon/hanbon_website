<template>
  <div class="chat-interface">
    <!-- ÁßëÊäÄÊÑüËÉåÊôØ -->
    <div class="tech-background">
      <div class="gradient-orb orb-1"></div>
      <div class="gradient-orb orb-2"></div>
      <div class="gradient-orb orb-3"></div>
      <div class="tech-grid"></div>
    </div>
    
    <!-- Ê¨¢ËøéÁïåÈù¢ -->
    <div v-if="!hasMessages" class="welcome-screen">
      <div class="welcome-content">
        <!-- LogoÂíåÊ†áÈ¢òÂå∫Âüü -->
        <div class="hero-section">
          <div class="logo-container">
            <img src="@/assets/hanbon_logo.png" alt="È£üÊÖßÁæéÈ£üAI" class="logo">
          </div>
          <h1 class="main-title">
            <span class="title-gradient">È£üÊÖßÁæéÈ£üAI</span>
          </h1>
          <p class="subtitle">
            <span class="subtitle-text">ÊÇ®ÁöÑ‰∏ìÂ±ûÁæéÈ£üÊô∫ËÉΩÈ°æÈóÆ</span>
            <span class="food-emoji">üç¥</span>
          </p>
        </div>
        
        <!-- ÂäüËÉΩÂç°ÁâáÁΩëÊ†º -->
        <div class="features-grid">
          <div 
            v-for="(item, index) in quickStartItems"
            :key="item.id"
            class="feature-card"
            :style="{ animationDelay: `${index * 0.1}s` }"
            @click="handleQuickStart(item.message)"
          >
            <div class="card-background"></div>
            <div class="card-content">
              <div class="card-icon-wrapper">
                <span class="card-icon">{{ item.icon }}</span>
              </div>
              <div class="card-text">
                <h3 class="card-title">{{ item.label }}</h3>
                <p class="card-description">{{ getCardDescription(item.id) }}</p>
              </div>
            </div>
            <div class="card-hover-effect"></div>
          </div>
        </div>
        
        <!-- Êô∫ËÉΩÊéßÂà∂Èù¢ÊùøÂ∑≤ÁßªÂà∞ËæìÂÖ•Ê°ÜÂÜÖ -->

        <!-- ËæìÂÖ•Âå∫Âüü -->
        <div class="input-section">
          <!-- Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥° -->
          <!-- <div class="example-bubbles" v-if="!inputMessage.trim()">
            <div class="bubbles-label">üí° ËØïËØïËøô‰∫õÔºö</div>
            <div class="bubbles-container">
              <div 
                v-for="example in quickExamples"
                :key="example.id"
                class="example-bubble"
                @click="handleExampleClick(example.text)"
              >
                <span class="bubble-icon">{{ example.icon }}</span>
                <span class="bubble-text">{{ example.text }}</span>
              </div>
            </div>
          </div> -->
          
          <!-- ÈõÜÊàêËæìÂÖ•Âç°Áâá -->
          <div class="integrated-input-card">
            <!-- AIÊ®°ÂûãÈÄâÊã©Âô® -->
            <div class="input-model-section">
              <div class="model-header">
                <span class="model-icon">ü§ñ</span>
                <span class="model-label">AI Â§ßËÑë</span>
              </div>
              <div class="model-selector-wrapper">
                <select 
                  v-model="selectedModel" 
                  class="integrated-model-selector"
                  :disabled="isLoading"
                >
                  <option 
                    v-for="model in availableModels" 
                    :key="model.id" 
                    :value="model.id"
                  >
                    {{ model.name }} - {{ model.description }}
                  </option>
                </select>
                <div class="selector-chevron">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Êô∫ËÉΩÂ∑•ÂÖ∑Áä∂ÊÄÅ -->
            <div v-if="enabledTools.length" class="input-tools-section">
              <div class="tools-header">
                <span class="tools-icon">üõ†Ô∏è</span>
                <span class="tools-label">Êô∫ËÉΩÂ∑•ÂÖ∑</span>
                <span class="tools-count">{{ enabledTools.length }}</span>
              </div>
              <div class="input-tools-grid">
                <div 
                  v-for="tool in enabledTools.slice(0, 6)"
                  :key="tool"
                  class="input-tool-chip"
                >
                  {{ getToolName(tool) }}
                </div>
                <div v-if="enabledTools.length > 6" class="input-tool-chip more-tools-chip">
                  +{{ enabledTools.length - 6 }}
                </div>
              </div>
            </div>
            
            <!-- ËæìÂÖ•Ê°ÜÂå∫Âüü -->
            <div class="input-wrapper">
              <textarea 
                ref="welcomeMessageInput"
                v-model="inputMessage"
                placeholder="‚ú® ‰∏éAIÂºÄÂßãÂØπËØùÔºåÊé¢Á¥¢ÁæéÈ£üÁöÑÊó†ÈôêÂèØËÉΩ..."
                class="main-input"
                @keydown="handleKeydown"
                @input="adjustHeight"
                :disabled="isLoading"
              ></textarea>
              
              <button 
                class="send-button"
                @click="sendMessage"
                :disabled="!canSend"
              >
                <span v-if="!isLoading" class="send-content">
                  <span class="send-text">ÂèëÈÄÅ</span>
                  <span class="send-icon">‚Üí</span>
                </span>
                <div v-else class="loading-spinner">
                  <div class="spinner"></div>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ÂØπËØùÊ∂àÊÅØÂå∫Âüü -->
    <div v-else class="messages-container" ref="messagesContainer">
      <div class="messages-list">
        <div
          v-for="(message, index) in messages"
          :key="message.id"
          class="message-wrapper"
          :class="message.type"
        >
          <!-- Âú®ÊúÄÂêé‰∏ÄÊù°AIÊ∂àÊÅØ‰πãÂâçÊòæÁ§∫ÊÄùÁª¥Èìæ -->
          <ThinkingChain 
            v-if="message.type === 'assistant' && index === messages.length - 1 && currentThinkingSteps.length > 0" 
            ref="thinkingChain"
            :steps="currentThinkingSteps"
            class="message-thinking-chain"
          />
          
          <div class="message-bubble" :class="{ error: message.isError }">
            <div class="message-content" v-html="formatMessage(message.content)"></div>
            
            <!-- Â∑•ÂÖ∑ÁªìÊûúÂ±ïÁ§∫ -->
            <div v-if="message.toolResults && message.toolResults.length" class="tool-results-container">
              <ToolResultDisplay 
                v-for="(result, index) in message.toolResults"
                :key="`${message.id}-tool-${index}`"
                :data="result"
                @requestRecipe="handleRecipeRequest"
                @requestImages="handleImageRequest"
                @retryTool="handleToolRetry"
              />
            </div>
            
            <div class="message-meta">
              <span class="timestamp">{{ formatTime(message.timestamp) }}</span>
              <div v-if="message.toolsUsed && message.toolsUsed.length" class="tools-used">
                <span v-for="tool in message.toolsUsed" :key="tool" class="tool-tag">
                  {{ getToolName(tool) }}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- AIÊÄùËÄÉ‰∏≠ÊèêÁ§∫ÔºàÂè™Âú®Ê≤°ÊúâÊÄùÁª¥ÈìæÊó∂ÊòæÁ§∫Ôºâ -->
        <div v-if="isLoading && currentThinkingSteps.length === 0" class="thinking-indicator">
          <div class="thinking-animation">
            <div class="thinking-dots">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
            <span class="thinking-text">AIÊ≠£Âú®ÊÄùËÄÉ‰∏≠...</span>
          </div>
        </div>
      </div>
      
              <!-- ÂØπËØùÁïåÈù¢ÁöÑËæìÂÖ•Âå∫Âüü -->
        <div class="chat-input-container">
        <!-- Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°ÔºàÂØπËØùÁïåÈù¢Ôºâ -->
        <!-- <div class="chat-example-bubbles" v-if="!inputMessage.trim() && !isLoading">
          <div class="chat-bubbles-container">
            <div 
              v-for="example in chatQuickExamples"
              :key="example.id"
              class="chat-example-bubble"
              @click="handleExampleClick(example.text)"
            >
              <span class="chat-bubble-icon">{{ example.icon }}</span>
              <span class="chat-bubble-text">{{ example.text }}</span>
            </div>
          </div>
        </div> -->
        
        <!-- ÈõÜÊàêËæìÂÖ•Ê°Ü -->
        <div class="chat-integrated-input-card">
          <!-- AIÂ§ßËÑëÂíåÊô∫ËÉΩÂ∑•ÂÖ∑Ê∞¥Âπ≥ÊéíÂàó -->
          <div class="chat-controls-row">
            <!-- AIÊ®°ÂûãÈÄâÊã©Âô® -->
            <div class="chat-model-section">
              <div class="chat-model-header">
                <span class="chat-model-icon">ü§ñ</span>
                <span class="chat-model-label">AI Â§ßËÑë</span>
              </div>
              <div class="chat-model-wrapper">
                <select 
                  v-model="selectedModel" 
                  class="chat-model-selector"
                  :disabled="isLoading"
                >
                  <option 
                    v-for="model in availableModels" 
                    :key="model.id" 
                    :value="model.id"
                  >
                    {{ model.name }}
                  </option>
                </select>
                <div class="chat-selector-chevron">
                  <svg viewBox="0 0 24 24" width="14" height="14">
                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Êô∫ËÉΩÂ∑•ÂÖ∑Áä∂ÊÄÅ -->
            <div v-if="enabledTools.length" class="chat-tools-section">
              <div class="chat-tools-header">
                <span class="chat-tools-icon">üõ†Ô∏è</span>
                <span class="chat-tools-label">Êô∫ËÉΩÂ∑•ÂÖ∑</span>
                <span class="chat-tools-count">{{ enabledTools.length }}</span>
              </div>
              <div class="chat-tools-chips">
                <div 
                  v-for="tool in enabledTools.slice(0, 3)"
                  :key="tool"
                  class="chat-tool-chip"
                >
                  {{ getToolName(tool) }}
                </div>
                <div v-if="enabledTools.length > 3" class="chat-more-chip">
                  +{{ enabledTools.length - 3 }}
                </div>
              </div>
            </div>
          </div>
          
          <!-- ËæìÂÖ•Ê°ÜÂå∫Âüü -->
          <div class="chat-input-wrapper">
            <div class="input-field-container">
              <textarea
                ref="messageInput"
                v-model="inputMessage"
                placeholder="ÁªßÁª≠ÂØπËØù... (Shift+EnterÊç¢Ë°åÔºåEnterÂèëÈÄÅ)"
                class="chat-input"
                @keydown="handleKeydown"
                @input="adjustHeight"
                @focus="handleInputFocus"
                @blur="handleInputBlur"
                :disabled="isLoading"
                rows="1"
              ></textarea>
              
              <!-- Â≠óÊï∞ÁªüËÆ° -->
              <div v-if="inputMessage.length > 0" class="char-count">
                {{ inputMessage.length }}
              </div>
            </div>
            
            <button 
              class="chat-send-btn"
              @click="sendMessage"
              :disabled="!canSend"
              :class="{ 'has-content': inputMessage.trim().length > 0 }"
            >
              <span v-if="!isLoading" class="send-icon">
                <svg viewBox="0 0 24 24" width="18" height="18">
                  <path fill="currentColor" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
              </span>
              <div v-else class="mini-spinner"></div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import ToolResultDisplay from './ToolResultDisplay.vue'
import ThinkingChain from './ThinkingChain.vue'
import { marked } from 'marked'

// ÈÖçÁΩÆ marked ÈÄâÈ°π
marked.setOptions({
  breaks: true, // ÊîØÊåÅÊç¢Ë°åÁ¨¶ËΩ¨‰∏∫ <br>
  gfm: true, // ÂêØÁî® GitHub È£éÊ†ºÁöÑ Markdown
  sanitize: false, // ‰∏çËøõË°å HTML Ê∏ÖÁêÜÔºàÊàë‰ª¨‰ºöÊâãÂä®Â§ÑÁêÜÔºâ
  smartLists: true, // Êô∫ËÉΩÂàóË°®
  smartypants: true // Êô∫ËÉΩÊ†áÁÇπÁ¨¶Âè∑
})

export default {
  name: 'ChatInterface',
  components: {
    ToolResultDisplay,
    ThinkingChain
  },
  props: {
    enabledTools: {
      type: Array,
      default: () => []
    }
  },
  emits: ['toolsUsed', 'messagesChanged'],
  data() {
    return {
      messages: [],
      inputMessage: '',
      isLoading: false,
      sessionId: '',
      
      // AIÊ®°ÂûãÁõ∏ÂÖ≥
      availableModels: [],
      selectedModel: '',
      defaultModel: '',
      
      // ÊâìÂ≠óÊú∫ÊïàÊûúÁõ∏ÂÖ≥
      typewriterBuffer: '', // ÁºìÂÜ≤Âå∫Â≠òÂÇ®Êé•Êî∂Âà∞ÁöÑÂÜÖÂÆπ
      typewriterRunning: false, // ÊòØÂê¶Ê≠£Âú®ÊâßË°åÊâìÂ≠óÊú∫ÊïàÊûú
      currentTypingMessage: null, // ÂΩìÂâçÊ≠£Âú®ÊâìÂ≠óÁöÑÊ∂àÊÅØ
      
      // ÊÄùÁª¥ÈìæÁõ∏ÂÖ≥
      currentThinkingSteps: [], // ÂΩìÂâçÊ≠£Âú®Â§ÑÁêÜÁöÑÊÄùÁª¥ÈìæÊ≠•È™§
      
      quickStartItems: [
        { id: 1, label: 'Êé®ËçêÁæéÈ£ü', icon: 'üçΩÔ∏è', message: 'ËØ∑Êé®Ëçê‰∏Ä‰∫õÈÄÇÂêàÁé∞Âú®ÁöÑÁæéÈ£ü' },
        { id: 2, label: 'Êü•ÁúãËèúË∞±', icon: 'üìö', message: 'ÊàëÊÉ≥Â≠¶ÂÅö‰∏ÄÈÅìÂÆ∂Â∏∏Ëèú' },
        { id: 3, label: 'ÈôÑËøëÈ§êÂéÖ', icon: 'üìç', message: 'Â∏ÆÊàëÊâæÊâæÈôÑËøëÊúâ‰ªÄ‰πàÂ•ΩÂêÉÁöÑÈ§êÂéÖ' },
        { id: 4, label: 'Ëê•ÂÖªÂàÜÊûê', icon: 'ü•ó', message: 'ËÉΩÂ∏ÆÊàëÂàÜÊûê‰∏Ä‰∏ãÈ£üÁâ©ÁöÑËê•ÂÖªÊàêÂàÜÂêóÔºü' }
      ],
      
      // Ê¨¢ËøéÁïåÈù¢Êé®Ëçê‰æãÂ≠ê
      quickExamples: [
        { id: 1, icon: 'üçú', text: 'Êé®ËçêÂ∑ùËèú' },
        { id: 2, icon: 'üìç', text: 'ÈôÑËøëÈ§êÂéÖ' },
        { id: 3, icon: 'ü•ò', text: 'Â≠¶ÂÅöËèúË∞±' },
        { id: 4, icon: 'üç∞', text: 'ÁîúÁÇπÂà∂‰Ωú' },
        { id: 5, icon: 'ü•ó', text: 'Ëê•ÂÖªÂàÜÊûê' },
        { id: 6, icon: 'üå∂Ô∏è', text: 'Ëæ£Âë≥Êé®Ëçê' }
      ],
      
      // ÂØπËØùÁïåÈù¢Êé®Ëçê‰æãÂ≠êÔºàÊõ¥ÁÆÄÊ¥ÅÔºâ
      chatQuickExamples: [
        { id: 1, icon: 'üç≥', text: 'Êç¢‰∏™ËèúË∞±' },
        { id: 2, icon: 'üìç', text: 'Êü•Áúã‰ΩçÁΩÆ' },
        { id: 3, icon: 'üîç', text: 'ÊêúÁ¥¢ÂõæÁâá' },
        { id: 4, icon: 'üí°', text: 'Êõ¥Â§öÂª∫ËÆÆ' }
      ],
      
      toolsMap: {
        'amap_search': 'Âú∞ÂõæÊêúÁ¥¢',
        'food_recommendation': 'ÁæéÈ£üÊé®Ëçê',
        'weather_api': 'Â§©Ê∞îÂä©Êâã',
        'image_search': 'ÂõæÁâáÊêúÁ¥¢',
        'bing_search': 'ÁΩëÁªúÊêúÁ¥¢',
        'recipe_generator': 'ËèúË∞±ÁîüÊàê'
      }
    }
  },
  computed: {
    hasMessages() {
      return this.messages.length > 0
    },
    canSend() {
      return this.inputMessage.trim() && !this.isLoading
    }
  },
  async mounted() {
    this.sessionId = this.generateSessionId()
    await this.loadAvailableModels()
    this.initImageViewer()
  },
  methods: {
    async loadAvailableModels() {
      try {
        const response = await fetch('http://localhost:8000/models/available')
        if (response.ok) {
          const data = await response.json()
          this.availableModels = data.models || []
          this.defaultModel = data.default_model || ''
          this.selectedModel = this.defaultModel
          console.log('ÂèØÁî®Ê®°ÂûãÂàóË°®:', this.availableModels)
        } else {
          console.error('Ëé∑ÂèñÊ®°ÂûãÂàóË°®Â§±Ë¥•:', response.status)
          // ËÆæÁΩÆÈªòËÆ§Ê®°Âûã‰Ωú‰∏∫ÂõûÈÄÄ
          this.availableModels = [
            { id: 'deepseek', name: 'DeepSeek', description: '‰∏ì‰∏öÁöÑ‰∏≠ÊñáÂØπËØùÊ®°Âûã' }
          ]
          this.selectedModel = 'deepseek'
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊ®°ÂûãÂàóË°®Â§±Ë¥•:', error)
        // ËÆæÁΩÆÈªòËÆ§Ê®°Âûã‰Ωú‰∏∫ÂõûÈÄÄ
        this.availableModels = [
          { id: 'deepseek', name: 'DeepSeek', description: '‰∏ì‰∏öÁöÑ‰∏≠ÊñáÂØπËØùÊ®°Âûã' }
        ]
        this.selectedModel = 'deepseek'
      }
    },

    generateSessionId() {
      return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    },
    
    handleQuickStart(message) {
      this.inputMessage = message
      this.sendMessage()
    },
    
    /**
     * @description Â§ÑÁêÜÊé®Ëçê‰æãÂ≠êÁÇπÂáª
     * @param {string} exampleText - ‰æãÂ≠êÊñáÊú¨
     */
    handleExampleClick(exampleText) {
      this.inputMessage = exampleText
      // Ëá™Âä®Ë∞ÉÊï¥ËæìÂÖ•Ê°ÜÈ´òÂ∫¶
      this.$nextTick(() => {
        this.adjustHeight()
      })
    },
    
    handleKeydown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault()
        this.sendMessage()
      }
    },
    
    adjustHeight() {
      // Âú®Ê¨¢ËøéÁïåÈù¢Êó∂‰ΩøÁî®welcomeMessageInputÔºåÂú®ÂØπËØùÁïåÈù¢Êó∂‰ΩøÁî®messageInput
      const textarea = this.hasMessages 
        ? this.$refs.messageInput 
        : this.$refs.welcomeMessageInput
        
      if (textarea) {
        textarea.style.height = 'auto'
        const newHeight = Math.min(textarea.scrollHeight, 120)
        textarea.style.height = `${newHeight}px`
        
        // Â¶ÇÊûúÂÜÖÂÆπË∂ÖËøáÊúÄÂ§ßÈ´òÂ∫¶ÔºåÊòæÁ§∫ÊªöÂä®Êù°
        if (textarea.scrollHeight > 120) {
          textarea.style.overflowY = 'auto'
        } else {
          textarea.style.overflowY = 'hidden'
        }
      }
    },

    /**
     * @description Â§ÑÁêÜËæìÂÖ•Ê°ÜËé∑ÂæóÁÑ¶ÁÇπ
     */
    handleInputFocus() {
      // ËæìÂÖ•Ê°ÜËé∑ÂæóÁÑ¶ÁÇπÊó∂ÁöÑÂ§ÑÁêÜ
      this.$nextTick(() => {
        this.scrollToBottom()
      })
    },

    /**
     * @description Â§ÑÁêÜËæìÂÖ•Ê°ÜÂ§±ÂéªÁÑ¶ÁÇπ
     */
    handleInputBlur() {
      // ËæìÂÖ•Ê°ÜÂ§±ÂéªÁÑ¶ÁÇπÊó∂ÁöÑÂ§ÑÁêÜ
      // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†‰øùÂ≠òËçâÁ®øÁ≠âÂäüËÉΩ
    },
    
    async sendMessage() {
      if (!this.canSend) return
      
      const messageText = this.inputMessage.trim()
      this.inputMessage = ''
      this.adjustHeight()
      
      // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
      const userMessage = {
        id: this.generateMessageId(),
        type: 'user',
        content: messageText,
        timestamp: new Date().toISOString()
      }
      
      this.messages.push(userMessage)
      this.scrollToBottom()
      
      // ÈÄöÁü•Áà∂ÁªÑ‰ª∂Ê∂àÊÅØÁä∂ÊÄÅÂèòÂåñ
      this.$emit('messagesChanged')
      
      // Ëé∑ÂèñAIÂìçÂ∫î
      await this.getAIResponse(messageText)
    },
    
    async getAIResponse(message) {
      this.isLoading = true
      
      // Ê∑ªÂä†AIÊ∂àÊÅØÂç†‰ΩçÁ¨¶
      const aiMessage = {
        id: this.generateMessageId(),
        type: 'assistant',
        content: '',
        timestamp: new Date().toISOString(),
        toolsUsed: []
      }
      
      this.messages.push(aiMessage)
      this.scrollToBottom()
      
      try {
        const response = await fetch(`http://localhost:8000/chat/stream`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: message,
            session_id: this.sessionId,
            tools_enabled: this.enabledTools,
            model: this.selectedModel
          })
        })
        
        if (!response.ok) {
          throw new Error('ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•')
        }
        
        await this.processStreamResponse(response, aiMessage)
        
      } catch (error) {
        console.error('AIÂìçÂ∫îÂ§±Ë¥•:', error)
        aiMessage.content = 'Êä±Ê≠âÔºåAIÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ'
        aiMessage.isError = true
        // Á´ãÂç≥ÈáçÁΩÆloadingÁä∂ÊÄÅ
        this.isLoading = false
      } finally {
        // Á°Æ‰øùÁä∂ÊÄÅË¢´ÈáçÁΩÆÔºàÂèåÈáç‰øùÈô©Ôºâ
        this.isLoading = false
        // ÈáçÁΩÆÊâìÂ≠óÊú∫Áä∂ÊÄÅ
        this.typewriterBuffer = ''
        this.typewriterRunning = false
        this.currentTypingMessage = null
      }
    },
    
    async processStreamResponse(response, aiMessage) {
      const reader = response.body.getReader()
      const decoder = new TextDecoder()
      let buffer = ''
      
      try {
        // eslint-disable-next-line no-constant-condition
        while (true) {
          const { done, value } = await reader.read()
          if (done) break
          
          buffer += decoder.decode(value, { stream: true })
          const lines = buffer.split('\n')
          
          // ‰øùÁïôÊúÄÂêé‰∏ÄË°åÔºàÂèØËÉΩ‰∏çÂÆåÊï¥Ôºâ
          buffer = lines.pop() || ''
          
          for (const line of lines) {
            const trimmedLine = line.trim()
            if (trimmedLine.startsWith('data: ')) {
              try {
                const jsonStr = trimmedLine.slice(6).trim()
                if (jsonStr && jsonStr !== '[DONE]') {
                  const data = JSON.parse(jsonStr)
                  
                  // Â§ÑÁêÜÂêÑÁßçÁ±ªÂûãÁöÑÊµÅÂºèÊï∞ÊçÆ
                  if (data.type === 'start') {
                    console.log('ÂºÄÂßãÂ§ÑÁêÜ:', data.content)
                    // ÈáçÁΩÆÊÄùÁª¥ÈìæÊ≠•È™§
                    this.currentThinkingSteps = []
                  } else if (data.type === 'thinking_step') {
                    // Â§ÑÁêÜÊÄùÁª¥ÈìæÊ≠•È™§
                    this.handleThinkingStep(data)
                    // Â¶ÇÊûúÊòØÁ¨¨ÂõõÊ≠•ÂÆåÊàêÔºåËÆ∞ÂΩïÂÆåÊàêÁä∂ÊÄÅ
                    if (data.step === 4 && data.status === 'completed') {
                      console.log('ÊÄùÁª¥ÈìæÁ¨¨ÂõõÊ≠•Â∑≤ÂÆåÊàê')
                    }
                  } else if (data.type === 'plan') {
                    console.log('ËÆ°ÂàíÈò∂ÊÆµ:', data.content)
                  } else if (data.type === 'action') {
                    console.log('ÊâßË°åÂ∑•ÂÖ∑:', data.content)
                  } else if (data.type === 'generating') {
                    console.log('ÁîüÊàêÂõûÂ§ç:', data.content)
                  } else if (data.type === 'response_chunk') {
                     // ËøôÊòØÁúüÊ≠£ÁöÑÂõûÂ§çÂÜÖÂÆπÔºåÊ∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
                     this.addToTypewriterBuffer(aiMessage, data.content || '')
                   } else if (data.type === 'content' || data.type === 'chunk') {
                     // ÂÖºÂÆπÂÖ∂‰ªñÊ†ºÂºèÔºåÊ∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
                     this.addToTypewriterBuffer(aiMessage, data.content || '')
                                                       } else if (data.type === 'complete') {
                    // Â§ÑÁêÜÂÆåÊàê‰ø°Âè∑
                    if (data.content && data.content.tools_used) {
                      aiMessage.toolsUsed = data.content.tools_used
                      this.$emit('toolsUsed', aiMessage.toolsUsed)
                    }
                    console.log('ÂõûÂ§çÂÆåÊàê')
                    // Á´ãÂç≥ÂÖ≥Èó≠loadingÁä∂ÊÄÅ
                    this.isLoading = false
                    // Á≠âÂæÖÊâìÂ≠óÊú∫ÊïàÊûúÂÆåÊàê
                    await this.waitForTypewriterComplete()
                    // ÂÆåÊàêÂêéËß¶ÂèëÊÄùÁª¥ÈìæËá™Âä®Êî∂Ëµ∑ÔºàÂª∂ËøüÊâßË°åÔºåÁ°Æ‰øùÊÄùÁª¥ÈìæÁªÑ‰ª∂Â∑≤ÁªèÊ∏≤ÊüìÔºâ
                    this.$nextTick(() => {
                      this.triggerThinkingChainAutoCollapse()
                    })
                    break
                  } else if (data.type === 'action_result') {
                    // Â§ÑÁêÜÂ∑•ÂÖ∑ÊâßË°åÁªìÊûú
                    if (data.content) {
                      if (!aiMessage.toolResults) {
                        aiMessage.toolResults = []
                      }
                      // Â∞ÜÂ∑•ÂÖ∑ÁªìÊûúÊ∑ªÂä†Âà∞Ê∂àÊÅØ‰∏≠
                      if (Array.isArray(data.content)) {
                        aiMessage.toolResults.push(...data.content)
                      } else {
                        aiMessage.toolResults.push(data.content)
                      }
                    }
                  } else if (data.type === 'error') {
                    aiMessage.content += `\n[ÈîôËØØ: ${data.content}]`
                    aiMessage.isError = true
                    this.scrollToBottom()
                  }
                }
              } catch (e) {
                console.warn('Ëß£ÊûêÊµÅÊï∞ÊçÆÂ§±Ë¥•:', trimmedLine, e)
              }
            }
          }
        }
      } finally {
        reader.releaseLock()
        // Á°Æ‰øùloadingÁä∂ÊÄÅË¢´ÈáçÁΩÆ
        this.isLoading = false
      }
    },
    
    /**
     * @description Ê∑ªÂä†ÂÜÖÂÆπÂà∞ÊâìÂ≠óÊú∫ÁºìÂÜ≤Âå∫
     * @param {Object} message - Ê∂àÊÅØÂØπË±°
     * @param {string} content - Ë¶ÅÊ∑ªÂä†ÁöÑÂÜÖÂÆπ
     */
    addToTypewriterBuffer(message, content) {
      if (!content) return
      
      // Â∞ÜÂÜÖÂÆπÊ∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
      this.typewriterBuffer += content
      
      // Â¶ÇÊûúÊâìÂ≠óÊú∫Ê≤°ÊúâËøêË°åÔºåÂêØÂä®ÂÆÉ
      if (!this.typewriterRunning && message) {
        this.currentTypingMessage = message
        this.startTypewriter()
      }
    },
    
    /**
     * @description ÂêØÂä®ÊâìÂ≠óÊú∫ÊïàÊûú
     */
    async startTypewriter() {
      if (this.typewriterRunning) return
      
      this.typewriterRunning = true
      
      while (this.typewriterBuffer.length > 0 || (this.isLoading && this.currentTypingMessage)) {
        if (this.typewriterBuffer.length > 0 && this.currentTypingMessage) {
          // ÂèñÂá∫‰∏Ä‰∏™Â≠óÁ¨¶
          const char = this.typewriterBuffer.charAt(0)
          this.typewriterBuffer = this.typewriterBuffer.slice(1)
          
          // ÊòæÁ§∫Â≠óÁ¨¶
          this.currentTypingMessage.content += char
          this.scrollToBottom()
          
          // ÊéßÂà∂ÊâìÂ≠óÈÄüÂ∫¶
          await this.delay(20) // 20ms ÊØîËæÉÂø´ÁöÑÊâìÂ≠óÈÄüÂ∫¶
        } else if (this.isLoading) {
          // Âè™ÊúâÂú®Âä†ËΩΩ‰∏≠‰∏îÊúâÂΩìÂâçÊ∂àÊÅØÊó∂ÊâçÁ≠âÂæÖ
          await this.delay(50)
        } else {
          // Êó¢Ê≤°ÊúâÂÜÖÂÆπ‰πü‰∏çÂú®Âä†ËΩΩ‰∏≠ÔºåÈÄÄÂá∫Âæ™ÁéØ
          break
        }
      }
      
      this.typewriterRunning = false
      this.currentTypingMessage = null
    },
    
    /**
     * @description Á≠âÂæÖÊâìÂ≠óÊú∫ÊïàÊûúÂÆåÊàê
     */
    async waitForTypewriterComplete() {
      while (this.typewriterRunning || this.typewriterBuffer.length > 0) {
        await this.delay(100)
      }
    },
    
    /**
     * @description Âª∂ËøüÂáΩÊï∞
     * @param {number} ms - Âª∂ËøüÊØ´ÁßíÊï∞
     */
    delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms))
    },
    
    generateMessageId() {
      return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    },
    
    scrollToBottom() {
      this.$nextTick(() => {
        const container = this.$refs.messagesContainer
        if (container) {
          container.scrollTop = container.scrollHeight
        }
      })
    },
    
    formatMessage(content) {
      // È¶ñÂÖàÂ∞ùËØïËß£ÊûêJSONÊ†ºÂºèÁöÑÂ∑•ÂÖ∑ÁªìÊûú
      try {
        // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Â∑•ÂÖ∑ÁªìÊûúÁöÑÊ†áËØÜ
        if (content.includes('„ÄêÂõæÁâáÂ±ïÁ§∫„Äë') || content.includes('ÂõæÁâáÂ±ïÁ§∫Ôºö')) {
          return this.formatImageResults(content)
        }
        
        if (content.includes('üìç') || content.includes('Âú∞ÂùÄÔºö') || content.includes('‰ΩçÁΩÆÔºö')) {
          return this.formatLocationResults(content)
        }
        
        if (content.includes('üçΩÔ∏è') || content.includes('ËèúË∞±Ôºö') || content.includes('Âà∂‰ΩúÊ≠•È™§Ôºö')) {
          return this.formatRecipeResults(content)
        }
      } catch (e) {
        console.log('Â∑•ÂÖ∑ÁªìÊûúËß£ÊûêÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Ê†ºÂºèÂåñ:', e)
      }
      
      // ‰ΩøÁî® marked Â∫ìËøõË°åÂÆåÊï¥ÁöÑ Markdown Ê∏≤Êüì
      let formatted = ''
      try {
        formatted = marked(content)
      } catch (e) {
        console.warn('Markdown Ê∏≤ÊüìÂ§±Ë¥•Ôºå‰ΩøÁî®Âü∫Á°ÄÊ†ºÂºèÂåñ:', e)
        // ÂõûÈÄÄÂà∞Âü∫Á°ÄÂ§ÑÁêÜ
        formatted = content
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/\n/g, '<br>')
      }
      
      // Â§ÑÁêÜÂõæÁâáURL (httpÂºÄÂ§¥ÁöÑÂõæÁâáÈìæÊé•)
      formatted = this.processImageUrls(formatted)
      
      // Â§ÑÁêÜÂú∞ÂõæÈìæÊé•
      formatted = this.processMapLinks(formatted)
      
      return formatted
    },
    
    /**
     * Ê†ºÂºèÂåñÂõæÁâáÊêúÁ¥¢ÁªìÊûú
     */
    formatImageResults(content) {
      // ÊèêÂèñÂõæÁâáURLÁöÑÊ≠£ÂàôË°®ËææÂºè
      const imageUrlRegex = /(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|webp|bmp)(?:\?[^\s]*)?)/gi
      const urls = content.match(imageUrlRegex) || []
      
      if (urls.length === 0) {
        return this.processImageUrls(content)
      }
      
      // ÊûÑÂª∫ÂõæÁâáÁîªÂªäHTML
      let galleryHtml = `
        <div class="tool-result-container image-gallery">
          <div class="tool-result-header">
            <span class="tool-icon">üì∑</span>
            <span class="tool-title">ÂõæÁâáÊêúÁ¥¢ÁªìÊûú</span>
          </div>
          <div class="image-grid">
      `
      
             urls.forEach((url, index) => {
         if (index < 6) { // ÊúÄÂ§öÊòæÁ§∫6Âº†ÂõæÁâá
           galleryHtml += `
             <div class="image-item">
               <img src="${url}" alt="ÁæéÈ£üÂõæÁâá ${index + 1}" 
                    onclick="window.showImageModal(event, '${url}')"
                    onerror="this.style.display='none'"
                    loading="lazy" />
             </div>
           `
         }
       })
      
      galleryHtml += `
          </div>
          ${urls.length > 6 ? `<div class="image-count">ËøòÊúâ ${urls.length - 6} Âº†ÂõæÁâá...</div>` : ''}
        </div>
      `
      
      // ÁßªÈô§ÂéüÂßãURLÔºå‰øùÁïôÂÖ∂‰ªñÊñáÊú¨ÂÜÖÂÆπ
      let cleanContent = content
      urls.forEach(url => {
        cleanContent = cleanContent.replace(url, '')
      })
      
      // ‰ΩøÁî® marked Â∫ìÊ∏≤ÊüìÂâ©‰ΩôÁöÑÊñáÊú¨ÂÜÖÂÆπ
      try {
        cleanContent = marked(cleanContent.replace(/\s+/g, ' ').trim())
      } catch (e) {
        cleanContent = cleanContent
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/\n/g, '<br>')
          .replace(/\s+/g, ' ')
          .trim()
      }
      
      return cleanContent + galleryHtml
    },
    
    /**
     * Ê†ºÂºèÂåñÂú∞ÁêÜ‰ΩçÁΩÆÁªìÊûú
     */
    formatLocationResults(content) {
      // ÊèêÂèñÂú∞ÂùÄÂíå‰ΩçÁΩÆ‰ø°ÊÅØÁöÑÊ≠£ÂàôË°®ËææÂºè
      const addressRegex = /Âú∞ÂùÄ[Ôºö:]\s*([^\n\r]+)/g
      const coordRegex = /location[Ôºö:]\s*([0-9.]+),([0-9.]+)/g
      
      let locationHtml = ''
      let match
      
      // ÊèêÂèñÂú∞ÂùÄ‰ø°ÊÅØ
      const addresses = []
      while ((match = addressRegex.exec(content)) !== null) {
        addresses.push(match[1].trim())
      }
      
      // ÊèêÂèñÂùêÊ†á‰ø°ÊÅØ
      const coordinates = []
      while ((match = coordRegex.exec(content)) !== null) {
        coordinates.push({
          lng: parseFloat(match[1]),
          lat: parseFloat(match[2])
        })
      }
      
      if (addresses.length > 0 || coordinates.length > 0) {
        locationHtml = `
          <div class="tool-result-container location-result">
            <div class="tool-result-header">
              <span class="tool-icon">üìç</span>
              <span class="tool-title">‰ΩçÁΩÆ‰ø°ÊÅØ</span>
            </div>
            <div class="location-list">
        `
        
        addresses.forEach((address, index) => {
          const coord = coordinates[index]
          locationHtml += `
            <div class="location-item">
              <div class="location-address">${address}</div>
              ${coord ? `
                <div class="location-actions">
                  <a href="https://uri.amap.com/marker?position=${coord.lng},${coord.lat}&name=${encodeURIComponent(address)}" 
                     target="_blank" class="map-link">
                    üó∫Ô∏è Âú®Âú∞Âõæ‰∏≠Êü•Áúã
                  </a>
                </div>
              ` : ''}
            </div>
          `
        })
        
        locationHtml += `
            </div>
          </div>
        `
      }
      
      // Ê∏ÖÁêÜÂÜÖÂÆπ
      let cleanContent = content
        .replace(addressRegex, '')
        .replace(coordRegex, '')
        .replace(/\s+/g, ' ')
        .trim()
      
      // ‰ΩøÁî® marked Â∫ìÊ∏≤ÊüìÂâ©‰ΩôÁöÑÊñáÊú¨ÂÜÖÂÆπ
      try {
        cleanContent = marked(cleanContent)
      } catch (e) {
        cleanContent = cleanContent
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/\n/g, '<br>')
      }
      
      return cleanContent + locationHtml
    },
    
    /**
     * Ê†ºÂºèÂåñËèúË∞±ÁªìÊûú
     */
    formatRecipeResults(content) {
      // ÊèêÂèñÂà∂‰ΩúÊ≠•È™§
      const stepsRegex = /(\d+)\.\s*([^\n\r]+)/g
      const ingredientsRegex = /„ÄêÈ£üÊùêÂáÜÂ§á„Äë([\s\S]*?)„Äê|„ÄêÈ£üÊùê.*?„Äë([\s\S]*?)„Äê/
      
      let recipeHtml = ''
      let match
      const steps = []
      
      // ÊèêÂèñÊ≠•È™§
      while ((match = stepsRegex.exec(content)) !== null) {
        steps.push({
          number: match[1],
          instruction: match[2].trim()
        })
      }
      
      // ÊèêÂèñÈ£üÊùê
      const ingredientsMatch = content.match(ingredientsRegex)
      const ingredients = ingredientsMatch ? 
        (ingredientsMatch[1] || ingredientsMatch[2]).split(/[,Ôºå\n]/).filter(item => item.trim()) : []
      
      if (steps.length > 0 || ingredients.length > 0) {
        recipeHtml = `
          <div class="tool-result-container recipe-result">
            <div class="tool-result-header">
              <span class="tool-icon">üë®‚Äçüç≥</span>
              <span class="tool-title">ËèúË∞±ËØ¶ÊÉÖ</span>
            </div>
        `
        
        if (ingredients.length > 0) {
          recipeHtml += `
            <div class="recipe-section">
              <h4 class="recipe-section-title">ü•ò È£üÊùêÂáÜÂ§á</h4>
              <div class="ingredients-list">
                ${ingredients.map(ingredient => `
                  <span class="ingredient-item">${ingredient.trim()}</span>
                `).join('')}
              </div>
            </div>
          `
        }
        
        if (steps.length > 0) {
          recipeHtml += `
            <div class="recipe-section">
              <h4 class="recipe-section-title">üìù Âà∂‰ΩúÊ≠•È™§</h4>
              <div class="steps-list">
                ${steps.map(step => `
                  <div class="step-item">
                    <span class="step-number">${step.number}</span>
                    <span class="step-instruction">${step.instruction}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          `
        }
        
        recipeHtml += `</div>`
      }
      
      // Ê∏ÖÁêÜÂÜÖÂÆπ
      let cleanContent = content
        .replace(stepsRegex, '')
        .replace(ingredientsRegex, '')
        .replace(/„Äê[^„Äë]*„Äë/g, '')
        .replace(/\s+/g, ' ')
        .trim()
      
      // ‰ΩøÁî® marked Â∫ìÊ∏≤ÊüìÂâ©‰ΩôÁöÑÊñáÊú¨ÂÜÖÂÆπ
      try {
        cleanContent = marked(cleanContent)
      } catch (e) {
        cleanContent = cleanContent
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/\n/g, '<br>')
      }
      
      return cleanContent + recipeHtml
    },
    
    /**
     * Â§ÑÁêÜÂõæÁâáURL
     */
    processImageUrls(content) {
      const imageUrlRegex = /(https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|bmp)(?:\?[^\s<>"]*)?)/gi
      
      return content.replace(imageUrlRegex, (url) => {
        const imageId = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
        return `
          <div class="inline-image" id="${imageId}_container">
            <img src="${url}" alt="ÂõæÁâá" 
                 id="${imageId}"
                 onclick="window.showImageModal(event, '${url}')"
                 onload="this.parentElement.classList.add('loaded')"
                 onerror="this.parentElement.innerHTML='<div class=\\"image-error\\">‚ùå ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•</div>'"
                 loading="lazy" />
          </div>
        `
      })
    },
    
    /**
     * ÂàùÂßãÂåñÂÖ®Â±ÄÂõæÁâáÊü•ÁúãÂô®
     */
    initImageViewer() {
      // ËÆæÁΩÆÂÖ®Â±ÄÂõæÁâáÊü•ÁúãÂô®ÊñπÊ≥ï
      window.showImageModal = (event, imageUrl) => {
        const fullUrl = imageUrl || event.target.src
        
        // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
        const modal = document.createElement('div')
        modal.className = 'image-modal'
        modal.innerHTML = `
          <div class="image-modal-backdrop" onclick="this.parentElement.remove()">
            <div class="image-modal-content" onclick="event.stopPropagation()">
              <img src="${fullUrl}" alt="ÊîæÂ§ßÂõæÁâá" />
              <button class="image-modal-close" onclick="this.closest('.image-modal').remove()">
                ‚úï
              </button>
            </div>
          </div>
        `
        
        document.body.appendChild(modal)
        
        // Ê∑ªÂä†ÈîÆÁõò‰∫ã‰ª∂ÁõëÂê¨ÔºàESCÂÖ≥Èó≠Ôºâ
        const handleKeydown = (e) => {
          if (e.key === 'Escape') {
            modal.remove()
            document.removeEventListener('keydown', handleKeydown)
          }
        }
        document.addEventListener('keydown', handleKeydown)
      }
    },
    
    /**
     * Â§ÑÁêÜÂú∞ÂõæÈìæÊé•
     */
    processMapLinks(content) {
      const mapUrlRegex = /(https?:\/\/(?:uri\.amap\.com|maps\.google\.com|map\.baidu\.com)[^\s<>"]+)/gi
      
      return content.replace(mapUrlRegex, (url) => {
        return `<a href="${url}" target="_blank" class="map-link">üó∫Ô∏è Âú®Âú∞Âõæ‰∏≠Êü•Áúã</a>`
      })
    },
    
    formatTime(timestamp) {
      const date = new Date(timestamp)
      return date.toLocaleTimeString('zh-CN', { 
        hour: '2-digit', 
        minute: '2-digit' 
      })
    },
    
    getToolName(tool) {
      return this.toolsMap[tool] || tool
    },
    
    getCardDescription(id) {
      const descriptions = {
        1: 'Ëé∑Âæó‰∏™ÊÄßÂåñÁæéÈ£üÊé®Ëçê',
        2: 'Â≠¶‰π†ËØ¶ÁªÜÂà∂‰ΩúÊ≠•È™§',
        3: 'ÂèëÁé∞Âë®Ëæπ‰ºòË¥®È§êÂéÖ',
        4: '‰∫ÜËß£È£üÁâ©Ëê•ÂÖªÊàêÂàÜ'
      }
      return descriptions[id] || ''
    },
    
    /**
     * @description Â§ÑÁêÜËèúË∞±ËØ∑Ê±Ç
     */
    handleRecipeRequest(dishName) {
      this.inputMessage = `ËØ∑ÁîüÊàê${dishName}ÁöÑËØ¶ÁªÜËèúË∞±`
      this.sendMessage()
    },
    
    /**
     * @description Â§ÑÁêÜÂõæÁâáÊêúÁ¥¢ËØ∑Ê±Ç  
     */
    handleImageRequest(dishName) {
      this.inputMessage = `ÁªôÊàëÁúãÁúã${dishName}ÁöÑÂõæÁâá`
      this.sendMessage()
    },
    
    /**
     * @description Â§ÑÁêÜÂ∑•ÂÖ∑ÈáçËØï
     */
    handleToolRetry(toolName) {
      console.log('ÈáçËØïÂ∑•ÂÖ∑:', toolName)
      // ÂèØ‰ª•ÈáçÊñ∞ÊâßË°å‰∏ä‰∏ÄÊ¨°ÁöÑÊ∂àÊÅØ
    },

    resetChat() {
      this.messages = []
      this.sessionId = this.generateSessionId()
      // ÈáçÁΩÆÊâìÂ≠óÊú∫Áä∂ÊÄÅ
      this.typewriterBuffer = ''
      this.typewriterRunning = false
      this.currentTypingMessage = null
      // ÈÄöÁü•Áà∂ÁªÑ‰ª∂Ê∂àÊÅØÁä∂ÊÄÅÂèòÂåñ
      this.$emit('messagesChanged')
    },

    /**
     * @description Â§ÑÁêÜÊÄùÁª¥ÈìæÊ≠•È™§
     * @param {Object} data - ÊÄùÁª¥ÈìæÊ≠•È™§Êï∞ÊçÆ
     */
    handleThinkingStep(data) {
      const { step, title, content, status } = data
      
      // Êü•ÊâæÊòØÂê¶Â∑≤Â≠òÂú®ËØ•Ê≠•È™§
      const existingStepIndex = this.currentThinkingSteps.findIndex(s => s.step === step)
      
      if (existingStepIndex !== -1) {
        // Êõ¥Êñ∞Áé∞ÊúâÊ≠•È™§
        this.currentThinkingSteps[existingStepIndex] = {
          step,
          title,
          content,
          status,
          timestamp: new Date().toISOString()
        }
      } else {
        // Ê∑ªÂä†Êñ∞Ê≠•È™§
        this.currentThinkingSteps.push({
          step,
          title,
          content,
          status,
          timestamp: new Date().toISOString()
        })
      }
      
      // ÊåâÊ≠•È™§ÁºñÂè∑ÊéíÂ∫è
      this.currentThinkingSteps.sort((a, b) => a.step - b.step)
      
      // ÊªöÂä®Âà∞Â∫ïÈÉ®‰ª•ÊòæÁ§∫ÊúÄÊñ∞ÁöÑÊÄùÁª¥ÈìæÊ≠•È™§
      this.scrollToBottom()
    },
    
    /**
     * @description Ê∏ÖÁêÜÊÄùÁª¥ÈìæÊ≠•È™§ÔºàÂØπËØùÂÆåÊàêÂêéË∞ÉÁî®Ôºâ
     */
    clearThinkingSteps() {
      // Á≠âÂæÖ2ÁßíÂêéÊ∏ÖÁêÜÊÄùÁª¥ÈìæÊ≠•È™§ÔºåËÆ©Áî®Êà∑ÊúâÊó∂Èó¥Êü•Áúã
      setTimeout(() => {
        this.currentThinkingSteps = []
      }, 3000)
    },

    /**
     * @description Ëß¶ÂèëÊÄùÁª¥ÈìæËá™Âä®Êî∂Ëµ∑
     */
    triggerThinkingChainAutoCollapse() {
      // ‰ΩøÁî®refËÆøÈóÆThinkingChainÁªÑ‰ª∂
      const thinkingChainComponent = this.$refs.thinkingChain
      if (thinkingChainComponent && typeof thinkingChainComponent.autoCollapse === 'function') {
        console.log('üéØ ÊâãÂä®Ëß¶ÂèëÊÄùÁª¥ÈìæËá™Âä®Êî∂Ëµ∑')
        thinkingChainComponent.autoCollapse()
      } else {
        console.log('‚ö†Ô∏è Êú™ÊâæÂà∞ThinkingChainÁªÑ‰ª∂ÊàñautoCollapseÊñπÊ≥ï')
      }
    }
  }
}
</script>

<style scoped>
/* ÂÖ®Â±ÄplaceholderÊ†∑ÂºèË¶ÜÁõñ */
::v-deep input::placeholder,
::v-deep textarea::placeholder {
  color: #bbb !important;
  opacity: 1 !important;
}
/* CSSÂèòÈáèÂÆö‰πâ */
.chat-interface {
  /* ÂÆö‰πâÁªÑ‰ª∂ÂÜÖÈÉ®‰ΩøÁî®ÁöÑCSSÂèòÈáè */
  --primary-color: #6C63FF;
  --secondary-color: #86A8E7;
  --background-color: #F7F9FB;
  --surface-color: #FFFFFF;
  --text-primary: #232946;
  --text-secondary: #6C63FF;
  --border-color: #E3E8F0;
  --shadow-color: rgba(134, 168, 231, 0.10);
  --success-color: #20c997;
  --warning-color: #fd7e14;
  --error-color: #e74c3c;
  --info-color: #6C63FF;
  
  /* È¢ùÂ§ñÁöÑCSSÂèòÈáèÁî®‰∫é‰∫§‰∫íÊïàÊûú */
  --card-background: rgba(255, 255, 255, 0.95);
  --card-border: rgba(108, 99, 255, 0.1);
  --card-hover-background: rgba(255, 255, 255, 1);
  --card-hover-border: rgba(108, 99, 255, 0.3);
  --card-shadow: 0 8px 32px rgba(108, 99, 255, 0.1);
  --card-hover-shadow: 0 16px 40px rgba(108, 99, 255, 0.2);
  
  /* ÊåâÈíÆÊ†∑ÂºèÂèòÈáè */
  --btn-background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  --btn-hover-background: linear-gradient(135deg, #5A52E8 0%, #7B9FE0 100%);
  --btn-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
  --btn-hover-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
}

.chat-interface {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--background-color);
  border-radius: 0;
  margin: 0;
  overflow: hidden;
  box-shadow: none;
  position: relative;
}

.tech-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  overflow: hidden;
  pointer-events: none;
}

.gradient-orb {
  position: absolute;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  opacity: 0.1;
  animation: orbit 20s linear infinite;
}

.orb-1 {
  top: -50px;
  left: -50px;
  background: radial-gradient(circle, rgba(108, 99, 255, 0.1) 0%, rgba(134, 168, 231, 0.1) 100%);
}

.orb-2 {
  top: 100px;
  right: -50px;
  background: radial-gradient(circle, rgba(145, 234, 228, 0.1) 0%, rgba(108, 99, 255, 0.1) 100%);
}

.orb-3 {
  bottom: -50px;
  left: 100px;
  background: radial-gradient(circle, rgba(108, 99, 255, 0.1) 0%, rgba(134, 168, 231, 0.1) 100%);
}

.tech-grid {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 70%);
  animation: grid-spin 10s linear infinite;
}

@keyframes orbit {
  0%, 100% {
    transform: translate(-20px, -20px) rotate(0deg);
  }
  50% {
    transform: translate(20px, 20px) rotate(180deg);
  }
}

@keyframes grid-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.welcome-screen {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
  background: linear-gradient(135deg, 
    rgba(108, 99, 255, 0.1) 0%, 
    rgba(134, 168, 231, 0.1) 50%, 
    rgba(145, 234, 228, 0.1) 100%
  );
  backdrop-filter: blur(20px);
  position: relative;
  overflow: hidden;
}

.welcome-screen::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, 
    transparent 30%, 
    rgba(108, 99, 255, 0.05) 50%, 
    transparent 70%
  );
  animation: floating-bg 20s ease-in-out infinite;
}

@keyframes floating-bg {
  0%, 100% {
    transform: translate(-20px, -20px) rotate(0deg);
  }
  50% {
    transform: translate(20px, 20px) rotate(180deg);
  }
}

.welcome-content {
  text-align: center;
  max-width: 700px;
  position: relative;
  z-index: 10;
  animation: fadeInUp 1s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.hero-section {
  margin-bottom: 50px;
  animation: heroFloat 3s ease-in-out infinite;
}

@keyframes heroFloat {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

.logo-container {
  margin-bottom: 24px;
  display: flex;
  justify-content: center;
}

.logo {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  transition: all 0.3s ease;
  box-shadow: 0 8px 25px rgba(108, 99, 255, 0.3);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.logo:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 25px 50px rgba(108, 99, 255, 0.4);
}

.main-title {
  font-size: 3.2em;
  font-weight: 800;
  margin-bottom: 16px;
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.02em;
  text-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
}

.subtitle {
  font-size: 1.4em;
  opacity: 0.8;
  margin-bottom: 16px;
  color: #5A67D8;
  font-weight: 500;
}

.subtitle-text {
  margin-right: 8px;
}

.food-emoji {
  font-size: 1.2em;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-top: 30px;
  margin-bottom: 35px;
}

.feature-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: var(--card-background);
  border: 2px solid var(--card-border);
  border-radius: 16px;
  color: var(--text-primary);
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(20px);
  position: relative;
  overflow: hidden;
  box-shadow: var(--card-shadow);
  text-align: left;
  animation: slideInUp 0.5s ease-out;
  z-index: 5;
  pointer-events: auto;
}

.feature-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(108, 99, 255, 0.1), 
    transparent
  );
  transition: left 0.6s ease;
}

.feature-card:hover::before {
  left: 100%;
}

.feature-card:hover {
  background: var(--card-hover-background);
  border-color: var(--card-hover-border);
  transform: translateY(-4px) scale(1.02);
  box-shadow: var(--card-hover-shadow);
  color: var(--text-primary);
}

.card-icon-wrapper {
  flex-shrink: 0;
  filter: drop-shadow(0 4px 8px rgba(108, 99, 255, 0.3));
  transition: transform 0.3s ease;
}

.feature-card:hover .card-icon-wrapper {
  transform: scale(1.1) rotate(5deg);
}

.card-content {
  flex: 1;
  text-align: left;
}

.card-title {
  font-size: 1.05em;
  font-weight: 700;
  margin-bottom: 4px;
  color: #2D3748;
}

.card-description {
  font-size: 0.85em;
  opacity: 0.7;
  color: #718096;
  line-height: 1.3;
  margin: 0;
}

/* Êô∫ËÉΩÊéßÂà∂Èù¢Êùø */
.control-panel {
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.95) 0%, 
    rgba(255, 255, 255, 0.85) 100%);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(108, 99, 255, 0.15);
  border-radius: 20px;
  padding: 24px;
  margin: 30px 0;
  box-shadow: 
    0 8px 32px rgba(108, 99, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
}

.control-panel:hover {
  border-color: rgba(108, 99, 255, 0.25);
  box-shadow: 
    0 12px 40px rgba(108, 99, 255, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

.control-section {
  margin-bottom: 20px;
}

.control-section:last-child {
  margin-bottom: 0;
}

.section-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  font-size: 14px;
  font-weight: 600;
  color: #4A5568;
}

.section-icon {
  font-size: 16px;
}

.section-title {
  flex: 1;
}

.tools-count {
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
  min-width: 20px;
  text-align: center;
}

.modern-selector {
  width: 100%;
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.9) 0%, 
    rgba(248, 250, 252, 0.9) 100%);
  border: 1px solid rgba(108, 99, 255, 0.2);
  border-radius: 14px;
  padding: 14px 16px;
  padding-right: 45px;
  font-size: 14px;
  color: var(--text-primary);
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  appearance: none;
  box-shadow: 
    0 2px 8px rgba(108, 99, 255, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  font-weight: 500;
}

.modern-selector:focus {
  border-color: var(--primary-color);
  box-shadow: 
    0 0 0 3px rgba(108, 99, 255, 0.12),
    0 4px 12px rgba(108, 99, 255, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.95) 0%, 
    rgba(248, 250, 252, 0.95) 100%);
}

.modern-selector:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  background: rgba(248, 250, 252, 0.5);
}

.selector-chevron {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: #6B7280;
  pointer-events: none;
  transition: all 0.3s ease;
}

.modern-selector:focus + .selector-chevron {
  color: var(--primary-color);
  transform: translateY(-50%) rotate(180deg);
}

.tools-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tool-chip {
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(108, 99, 255, 0.3);
  transition: all 0.3s ease;
}

.tool-chip:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(108, 99, 255, 0.4);
}

.more-tools-chip {
  background: linear-gradient(135deg, 
    rgba(108, 99, 255, 0.1) 0%, 
    rgba(134, 168, 231, 0.1) 100%);
  color: #6C63FF;
  border: 1px solid rgba(108, 99, 255, 0.2);
}

/* Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°Ê†∑Âºè */
.example-bubbles {
  margin-bottom: 20px;
  text-align: center;
}

.bubbles-label {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 12px;
  font-weight: 500;
}

.bubbles-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  max-width: 600px;
  margin: 0 auto;
}

.example-bubble {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  user-select: none;
}

.example-bubble:hover {
  background: rgba(108, 99, 255, 0.15);
  border-color: rgba(108, 99, 255, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(108, 99, 255, 0.15);
}

.example-bubble:active {
  transform: translateY(0);
  transition: transform 0.1s ease;
}

.bubble-icon {
  font-size: 14px;
  display: inline-block;
}

.bubble-text {
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
}

/* ÂØπËØùÁïåÈù¢Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°Ê†∑Âºè */
.chat-example-bubbles {
  padding: 0 20px 12px 20px;
  text-align: center;
}

.chat-bubbles-container {
  display: flex;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}

.chat-example-bubble {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 12px;
  color: var(--text-secondary);
  user-select: none;
}

.chat-example-bubble:hover {
  background: rgba(108, 99, 255, 0.12);
  border-color: rgba(108, 99, 255, 0.25);
  color: var(--text-primary);
  transform: translateY(-1px);
}

.chat-example-bubble:active {
  transform: translateY(0);
}

.chat-bubble-icon {
  font-size: 12px;
  display: inline-block;
}

.chat-bubble-text {
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
}

/* Ê¨¢ËøéÁïåÈù¢ËæìÂÖ•Ê°ÜÊ†∑Âºè */
.input-section {
  margin-top: 50px;
  width: 100%;
  animation: inputGlow 2s ease-in-out infinite alternate;
}

@keyframes inputGlow {
  0% {
    filter: drop-shadow(0 0 8px rgba(108, 99, 255, 0.3));
  }
  100% {
    filter: drop-shadow(0 0 16px rgba(108, 99, 255, 0.5));
  }
}

.input-card {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.98) 0%, 
    rgba(255, 255, 255, 0.95) 100%);
  border: 2px solid rgba(108, 99, 255, 0.2);
  border-radius: 24px;
  padding: 24px 28px;
  backdrop-filter: blur(20px);
  box-shadow: 
    0 12px 40px rgba(108, 99, 255, 0.15),
    0 4px 16px rgba(108, 99, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  transition: all 0.3s ease;
  pointer-events: auto;
  position: relative;
  overflow: hidden;
  animation: cardPulse 3s ease-in-out infinite;
}

@keyframes cardPulse {
  0%, 100% {
    transform: translateY(0px) scale(1);
    box-shadow: 
      0 12px 40px rgba(108, 99, 255, 0.15),
      0 4px 16px rgba(108, 99, 255, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }
  50% {
    transform: translateY(-2px) scale(1.01);
    box-shadow: 
      0 16px 50px rgba(108, 99, 255, 0.2),
      0 6px 20px rgba(108, 99, 255, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.95);
  }
}

.input-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(108, 99, 255, 0.08), 
    transparent);
  animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  50% {
    left: 100%;
  }
  100% {
    left: 100%;
  }
}

.input-card:focus-within {
  border-color: rgba(108, 99, 255, 0.4);
  box-shadow: 
    0 16px 50px rgba(108, 99, 255, 0.25),
    0 8px 25px rgba(108, 99, 255, 0.2),
    0 0 0 4px rgba(108, 99, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.95);
  transform: translateY(-3px) scale(1.02);
  animation: none;
}

.main-input {
  flex: 1;
  border: none;
  background: transparent;
  color: var(--text-primary);
  font-size: 16px;
  line-height: 1.5;
  padding: 18px 22px;
  resize: none;
  outline: none;
  min-height: 28px;
  max-height: 120px;
  font-family: inherit;
  pointer-events: auto;
  position: relative;
  z-index: 2;
}

.main-input::placeholder {
  color: rgba(108, 99, 255, 0.6) !important;
  opacity: 1;
  font-weight: 500;
  background: linear-gradient(45deg, #6C63FF, #86A8E7, #91EAE4);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientFlow 3s ease-in-out infinite;
}

@keyframes gradientFlow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* ËÅäÂ§©ËæìÂÖ•Ê°ÜplaceholderÊ†∑Âºè */
.chat-input {
  flex: 1;
  border: none;
  background: transparent;
  color: var(--text-primary);
  font-size: 16px;
  line-height: 1.5;
  resize: none;
  outline: none;
  min-height: 24px;
  max-height: 120px;
  font-family: inherit;
  pointer-events: auto;
}

.chat-input::placeholder {
  color: #bbb !important;
  opacity: 1;
  font-weight: 400;
}

.send-button {
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  color: white;
  border: none;
  border-radius: 16px;
  padding: 12px 20px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 
    0 4px 16px rgba(108, 99, 255, 0.3),
    0 2px 8px rgba(108, 99, 255, 0.2);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  min-width: 80px;
  pointer-events: auto;
  z-index: 10;
}

.send-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #584DE6 0%, #7294D3 100%);
  transform: translateY(-2px);
  box-shadow: 
    0 8px 25px rgba(108, 99, 255, 0.4),
    0 4px 16px rgba(108, 99, 255, 0.3);
}

.send-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* ÁßªÈô§ÊóßÁöÑÊ®°ÂûãÈÄâÊã©Âô®Ê†∑Âºè */

.model-selector-wrapper {
  position: relative;
  flex: 1;
}

.model-selector {
  flex: 1;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(108, 99, 255, 0.2);
  border-radius: 12px;
  padding: 12px 16px;
  font-size: 14px;
  color: var(--text-primary);
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  appearance: none;
  pointer-events: auto;
  z-index: 10;
}

.model-selector:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
}

.model-selector:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.selector-arrow {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 16px;
  color: var(--text-secondary);
  pointer-events: none;
}

/* ÂØπËØùÁïåÈù¢Áõ∏ÂÖ≥Ê†∑Âºè */
.messages-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.messages-list {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  scroll-behavior: smooth;
}

.message-wrapper {
  margin-bottom: 20px;
}

.message-wrapper.user {
  display: flex;
  justify-content: flex-end;
}

.message-wrapper.assistant {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.message-bubble {
  max-width: 75%;
  padding: 16px 20px;
  border-radius: 18px;
  line-height: 1.5;
  position: relative;
}

.message-wrapper.assistant .message-bubble {
  align-self: flex-start;
}

.message-wrapper.user .message-bubble {
  background: var(--btn-background);
  color: white;
  border-bottom-right-radius: 6px;
}

.message-wrapper.assistant .message-bubble {
  background: var(--surface-color);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-bottom-left-radius: 6px;
}

.message-bubble.error {
  background: rgba(231, 76, 60, 0.1);
  border-color: var(--error-color);
  color: var(--error-color);
}

.message-content {
  font-size: 15px;
  line-height: 1.6;
  margin: 0;
  margin-left: 30px;
}

/* Markdown ÂÖÉÁ¥†Ê†∑Âºè */
.message-content h1,
.message-content h2,
.message-content h3,
.message-content h4,
.message-content h5,
.message-content h6 {
  margin: 12px 0 8px 0;
  color: var(--text-primary);
  font-weight: 600;
}

.message-content h1 { font-size: 1.5em; }
.message-content h2 { font-size: 1.3em; }
.message-content h3 { font-size: 1.2em; }
.message-content h4 { font-size: 1.1em; }
.message-content h5 { font-size: 1.05em; }
.message-content h6 { font-size: 1em; }

.message-content p {
  margin: 8px 0;
}

.message-content ul,
.message-content ol {
  margin: 8px 0;
  padding-left: 24px;
}

.message-content li {
  margin: 4px 0;
}

.message-content blockquote {
  margin: 12px 0;
  padding: 8px 16px;
  border-left: 4px solid var(--primary-color);
  background: rgba(108, 99, 255, 0.1);
  border-radius: 0 8px 8px 0;
  font-style: italic;
}

.message-content code {
  background: rgba(108, 99, 255, 0.1);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
  font-size: 0.9em;
  color: var(--text-primary);
}

.message-content pre {
  background: rgba(108, 99, 255, 0.1);
  padding: 12px;
  border-radius: 8px;
  overflow-x: auto;
  margin: 12px 0;
  border: 1px solid var(--border-color);
}

.message-content pre code {
  background: none;
  padding: 0;
  border-radius: 0;
}

.message-content a {
  color: var(--primary-color);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-color 0.3s ease;
}

.message-content a:hover {
  border-bottom-color: var(--primary-color);
}

.message-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
}

.message-content th,
.message-content td {
  padding: 8px 12px;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
}

.message-content th {
  background: var(--surface-color);
  font-weight: 600;
  color: var(--text-primary);
}

.message-content tr:last-child th,
.message-content tr:last-child td {
  border-bottom: none;
}

.message-content hr {
  border: none;
  height: 1px;
  background: var(--border-color);
  margin: 16px 0;
}

.message-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 12px;
  opacity: 0.7;
}

.timestamp {
  color: inherit;
}

.tools-used {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.tool-tag {
  background: var(--primary-color);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 500;
}

.thinking-indicator {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0 20px 20px;
  padding: 16px 20px;
  background: var(--surface-color);
  border: 1px solid var(--border-color);
  border-radius: 18px;
  color: var(--text-secondary);
  font-size: 14px;
}

.thinking-animation {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding: 16px 20px;
  background: var(--surface-color);
  border: 1px solid var(--border-color);
  border-radius: 18px;
  color: var(--text-secondary);
  font-size: 14px;
}

.thinking-dots {
  display: flex;
  gap: 4px;
}

.thinking-dots .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--primary-color);
  animation: thinkingPulse 1.4s ease-in-out infinite both;
}

.thinking-dots .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.thinking-dots .dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes thinkingPulse {
  0%, 80%, 100% {
    transform: scale(0);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

/* ËæìÂÖ•Âå∫ÂüüÊ†∑Âºè */
.chat-input-container {
  padding: 20px;
  background: var(--surface-color);
  border-top: 1px solid var(--border-color);
}

.chat-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.chat-model-selector {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--surface-color);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  font-size: 13px;
}

.chat-model-selector .model-icon {
  font-size: 16px;
  color: var(--text-secondary);
}

.chat-model-selector .model-title {
  flex: 1;
}

.model-dropdown {
  border: none;
  background: transparent;
  font-size: 13px;
  color: var(--text-primary);
  cursor: pointer;
  outline: none;
  padding: 2px 4px;
}

.model-dropdown:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.chat-tools-status {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 12px;
}

.tools-icon {
  font-size: 16px;
  color: var(--text-secondary);
}

.tools-chips {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tool-chip {
  background: var(--btn-background);
  color: white;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  box-shadow: var(--btn-shadow);
}

.more-chip {
  background: rgba(108, 99, 255, 0.1);
  color: var(--primary-color);
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.chat-input-wrapper {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.9) 0%, 
    rgba(248, 250, 252, 0.9) 100%);
  border: 2px solid rgba(108, 99, 255, 0.12);
  border-radius: 20px;
  padding: 18px 22px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  box-shadow: 
    0 4px 20px rgba(108, 99, 255, 0.06),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
}

.chat-input-wrapper:focus-within {
  border-color: rgba(108, 99, 255, 0.4);
  box-shadow: 
    0 8px 25px rgba(108, 99, 255, 0.15),
    0 4px 16px rgba(108, 99, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  transform: translateY(-2px);
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.95) 0%, 
    rgba(248, 250, 252, 0.95) 100%);
}

/* Êñ∞Â¢ûËæìÂÖ•Â≠óÊÆµÂÆπÂô®Ê†∑Âºè */
.input-field-container {
  flex: 1;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* ‰ºòÂåñËæìÂÖ•Ê°ÜÊ†∑Âºè */
.chat-input {
  width: 100%;
  min-height: 24px;
  max-height: 120px;
  resize: none;
  border: none;
  outline: none;
  background: transparent;
  font-size: 16px;
  font-family: inherit;
  line-height: 1.5;
  color: var(--text-primary);
  overflow-y: hidden;
  transition: all 0.2s ease;
}

.chat-input::placeholder {
  color: rgba(108, 99, 255, 0.6);
  font-style: italic;
}

.chat-input:focus::placeholder {
  color: rgba(108, 99, 255, 0.4);
}

/* Â≠óÊï∞ÁªüËÆ°Ê†∑Âºè */
.char-count {
  position: absolute;
  bottom: 2px;
  right: 8px;
  font-size: 11px;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.9);
  padding: 2px 6px;
  border-radius: 8px;
  pointer-events: none;
  transition: all 0.2s ease;
}

/* ÂèëÈÄÅÊåâÈíÆ‰ºòÂåñ */
.chat-send-btn {
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
  color: white;
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  flex-shrink: 0;
  box-shadow: 
    0 4px 16px rgba(108, 99, 255, 0.3),
    0 2px 8px rgba(108, 99, 255, 0.2);
  pointer-events: auto;
  transform: scale(0.95);
}

.chat-send-btn.has-content {
  transform: scale(1);
  background: linear-gradient(135deg, #584DE6 0%, #7294D3 100%);
  box-shadow: 
    0 6px 20px rgba(108, 99, 255, 0.4),
    0 3px 12px rgba(108, 99, 255, 0.3);
}

.chat-send-btn:hover:not(:disabled) {
  background: linear-gradient(135deg, #4C45D9 0%, #6689CB 100%);
  transform: translateY(-2px) scale(1.05);
  box-shadow: 
    0 8px 25px rgba(108, 99, 255, 0.5),
    0 4px 16px rgba(108, 99, 255, 0.4);
}

.chat-send-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: scale(0.95);
}

.send-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s ease;
}

.chat-send-btn:hover .send-icon {
  transform: translateX(1px);
}

.chat-send-btn:active {
  transform: translateY(-1px) scale(0.98);
}

.chat-input-card {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.95) 0%, 
    rgba(255, 255, 255, 0.85) 100%);
  border: 1px solid rgba(108, 99, 255, 0.15);
  border-radius: 20px;
  padding: 16px 20px;
  backdrop-filter: blur(20px);
  box-shadow: 
    0 8px 32px rgba(108, 99, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  pointer-events: auto;
}

.chat-input-card:focus-within {
  border-color: rgba(108, 99, 255, 0.25);
  box-shadow: 
    0 12px 40px rgba(108, 99, 255, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  transform: translateY(-1px);
}



.mini-spinner {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ÁßªÂä®Á´Ø‰ºòÂåñ */
@media (max-width: 768px) {
  .chat-interface {
    margin: 8px;
    height: calc(100vh - 16px);
    border-radius: 8px;
  }
  
  .welcome-screen {
    padding: 20px 15px;
  }
  
  .title {
    font-size: 2.2em;
    line-height: 1.2;
    margin-bottom: 12px;
  }
  
  .subtitle {
    font-size: 1.1em;
    line-height: 1.4;
    margin-bottom: 20px;
  }
  
  .logo {
    width: 70px;
    height: 70px;
    margin-bottom: 16px;
  }
  
  .logo-section {
    margin-bottom: 35px;
  }
  
  .quick-start-cards {
    grid-template-columns: 1fr;
    gap: 14px;
    margin-top: 30px;
    margin-bottom: 30px;
  }
  
  .quick-start-card {
    padding: 18px;
    border-radius: 16px;
    gap: 16px;
  }
  
  .card-icon {
    font-size: 2.3em;
  }
  
  .card-title {
    font-size: 1.05em;
    margin-bottom: 6px;
  }
  
  .card-description {
    font-size: 0.88em;
    line-height: 1.3;
  }
  
  .welcome-tools-status {
    margin-bottom: 25px;
    padding: 14px 16px;
    border-radius: 12px;
  }
  
  .welcome-tools-status .tools-label {
    font-size: 13px;
    display: block;
    margin-bottom: 8px;
    margin-right: 0;
  }
  
  .welcome-tools-status .tools-list {
    display: flex;
    gap: 6px;
  }
  
  .welcome-tools-status .tool-badge {
    font-size: 11px;
    padding: 3px 10px;
  }
  
  .welcome-input-section {
    margin-top: 30px;
  }
  
  .welcome-input-wrapper {
    padding: 14px 16px;
    border-radius: 18px;
    gap: 12px;
  }
  
  .welcome-message-input {
    font-size: 16px; /* Èò≤Ê≠¢iOSËá™Âä®Áº©Êîæ */
    min-height: 20px;
  }
  
  .welcome-send-btn {
    padding: 12px 20px;
    font-size: 14px;
    border-radius: 14px;
    min-height: 44px; /* Ëß¶Êë∏ÂèãÂ•ΩÁöÑÊúÄÂ∞èÈ´òÂ∫¶ */
  }
  
  .messages-list {
    padding: 12px;
  }
  
  .message-wrapper {
    margin-bottom: 16px;
  }
  
  .message-bubble {
    max-width: 82%;
    padding: 14px 16px;
    border-radius: 16px;
  }
  
  .message-content {
    font-size: 15px;
    line-height: 1.5;
  }
  
  .message-meta {
    font-size: 11px;
    margin-top: 6px;
  }
  
  .thinking-indicator {
    margin: 0 12px 16px;
    padding: 14px 16px;
    border-radius: 12px;
  }
  
  .input-container {
    padding: 12px;
  }
  
  .tools-status {
    margin-bottom: 12px;
    padding: 10px 12px;
    border-radius: 10px;
  }
  
  .tools-status .tools-label {
    font-size: 13px;
    display: block;
    margin-bottom: 6px;
    margin-right: 0;
  }
  
  .tools-status .tools-list {
    gap: 6px;
  }
  
  .tools-status .tool-badge {
    font-size: 11px;
    padding: 3px 8px;
  }
  
  .input-wrapper {
    padding: 12px 14px;
    border-radius: 14px;
    gap: 10px;
  }

  .input-wrapper::placeholder {
  color: #000000; /* ËÆæÁΩÆ‰Ω†ÊÉ≥Ë¶ÅÁöÑÈ¢úËâ≤ */
}
  
  .message-input {
    font-size: 16px; /* Èò≤Ê≠¢iOSËá™Âä®Áº©Êîæ */
    min-height: 20px;
  }
  
  .send-btn {
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 10px;
    min-height: 40px; /* Ëß¶Êë∏ÂèãÂ•ΩÁöÑÊúÄÂ∞èÈ´òÂ∫¶ */
  }
  
  /* ÁßªÂä®ËÆæÂ§á‰∏äÁöÑÂ∑•ÂÖ∑ÁªìÊûúÊ†∑ÂºèË∞ÉÊï¥ */
  .tool-result-container {
    margin: 12px 0;
  }
  
  .tool-result-header {
    padding: 10px 12px;
    font-size: 13px;
  }
  
  /* ÁßªÂä®Á´ØÂõæÁâáÁΩëÊ†º‰ºòÂåñ */
  .tool-result-container.image-gallery {
    margin: 12px 0;
  }
  
  .tool-result-header {
    padding: 12px 16px;
    font-size: 14px;
  }
  
  .image-gallery .image-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 16px;
  }
  
  .image-item {
    min-height: 120px;
  }
  
  .image-item img {
    min-height: 120px;
  }
  
  .inline-image img {
    min-height: 120px;
  }
  
  .location-result .location-list {
    padding: 12px;
  }
  
  .location-item {
    padding: 10px;
    margin-bottom: 8px;
  }
  
  .location-address {
    font-size: 14px;
  }
  
  .map-link {
    padding: 8px 12px;
    font-size: 11px;
  }
  
  .recipe-section {
    padding: 12px;
  }
  
  .recipe-section-title {
    font-size: 15px;
  }
  
  .ingredients-list {
    gap: 6px;
  }
  
  .ingredient-item {
    padding: 4px 8px;
    font-size: 12px;
  }
  
  .step-item {
    padding: 10px;
    gap: 10px;
  }
  
  .step-number {
    width: 20px;
    height: 20px;
    font-size: 11px;
  }
  
  .step-instruction {
    font-size: 14px;
  }
}

/* Â∑•ÂÖ∑ÁªìÊûúÂÆπÂô®Ê†∑Âºè */
.tool-results-container {
  margin-top: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Ë¶ÜÁõñToolResultDisplay‰∏≠ÁöÑ‰∏Ä‰∫õÊ†∑Âºè‰ª•ÈÄÇÈÖçÊ∂àÊÅØÊ∞îÊ≥° */
.message-bubble .tool-result-display .result-container {
  margin: 0;
  border-radius: 8px;
  box-shadow: none;
  border: 1px solid var(--border-color);
}

.message-bubble .tool-result-display .result-header {
  padding: 12px 16px;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

/* Ë∞ÉÊï¥AIÊ∂àÊÅØ‰∏≠ÁöÑÂ∑•ÂÖ∑ÁªìÊûúÊ†∑Âºè */
.message-wrapper.assistant .tool-result-display .result-container {
  background: rgba(255, 255, 255, 0.8);
}

.message-wrapper.assistant .tool-result-display .result-container:hover {
  background: rgba(255, 255, 255, 0.95);
}

/* ÁßªÂä®Á´ØÈÄÇÈÖç */
@media (max-width: 768px) {
  .tool-results-container {
    margin-top: 12px;
    gap: 8px;
  }
  
  .message-bubble .tool-result-display .result-header {
    padding: 10px 12px;
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .chat-interface {
    margin: 4px;
    height: calc(100vh - 8px);
    border-radius: 6px;
  }
  
  .welcome-screen {
    padding: 16px 12px;
  }
  
  .welcome-content {
    max-width: 100%;
  }
  
  .title {
    font-size: 1.8em;
    margin-bottom: 10px;
  }
  
  .subtitle {
    font-size: 0.95em;
    margin-bottom: 16px;
  }
  
  .logo {
    width: 60px;
    height: 60px;
    margin-bottom: 14px;
  }
  
  .logo-section {
    margin-bottom: 28px;
  }
  
  .quick-start-cards {
    gap: 10px;
    margin-top: 25px;
    margin-bottom: 25px;
  }
  
  .quick-start-card {
    padding: 14px;
    flex-direction: column;
    text-align: center;
    gap: 10px;
    border-radius: 14px;
    min-height: 100px; /* Á°Æ‰øùËß¶Êë∏ÁõÆÊ†áË∂≥Â§üÂ§ß */
  }
  
  .card-content {
    text-align: center;
  }
  
  .card-icon {
    font-size: 1.8em;
  }
  
  .card-title {
    font-size: 0.95em;
    margin-bottom: 4px;
  }
  
  .card-description {
    font-size: 0.8em;
    line-height: 1.25;
  }
  
  .welcome-tools-status {
    margin-bottom: 20px;
    padding: 12px 14px;
  }
  
  .welcome-tools-status .tools-label {
    font-size: 12px;
  }
  
  .welcome-tools-status .tool-badge {
    font-size: 10px;
    padding: 2px 8px;
  }
  
  .welcome-input-section {
    margin-top: 25px;
  }
  
  .welcome-input-wrapper {
    flex-direction: column;
    gap: 12px;
    align-items: stretch;
    padding: 12px 14px;
    border-radius: 16px;
  }
  
  .welcome-message-input {
    font-size: 16px; /* Èò≤Ê≠¢iOSËá™Âä®Áº©Êîæ */
    min-height: 24px;
    text-align: center;
  }
  
  .welcome-send-btn {
    align-self: center;
    min-width: 140px;
    min-height: 48px; /* Êõ¥Â§ßÁöÑËß¶Êë∏ÁõÆÊ†á */
    padding: 14px 24px;
    font-size: 15px;
    border-radius: 16px;
  }
  
  .messages-list {
    padding: 8px;
  }
  
  .message-wrapper {
    margin-bottom: 12px;
  }
  
  .message-bubble {
    max-width: 88%;
    padding: 12px 14px;
    border-radius: 14px;
  }
  
  .message-content {
    font-size: 14px;
    line-height: 1.4;
  }
  
  .message-meta {
    font-size: 10px;
    margin-top: 4px;
  }
  
  .tool-tag {
    font-size: 9px;
    padding: 1px 6px;
  }
  
  .thinking-indicator {
    margin: 0 8px 12px;
    padding: 12px 14px;
    border-radius: 10px;
  }
  
  .thinking-indicator span {
    font-size: 13px;
  }
  
  .input-container {
    padding: 8px;
  }
  
  .tools-status {
    margin-bottom: 10px;
    padding: 8px 10px;
    border-radius: 8px;
  }
  
  .tools-status .tools-label {
    font-size: 12px;
    margin-bottom: 5px;
  }
  
  .tools-status .tool-badge {
    font-size: 10px;
    padding: 2px 6px;
  }
  
  .input-wrapper {
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
    padding: 10px 12px;
    border-radius: 12px;
  }
  
  .message-input {
    font-size: 16px; /* Èò≤Ê≠¢iOSËá™Âä®Áº©Êîæ */
    min-height: 24px;
    text-align: left;
  }
  
  .send-btn {
    align-self: center;
    min-width: 120px;
    min-height: 44px; /* Ëß¶Êë∏ÂèãÂ•ΩÁöÑÈ´òÂ∫¶ */
    padding: 12px 20px;
    font-size: 14px;
    border-radius: 12px;
  }
}

/* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ (iPhone SE Á≠â) */
@media (max-width: 375px) {
  .welcome-screen {
    padding: 12px 8px;
  }
  
  .title {
    font-size: 1.6em;
  }
  
  .subtitle {
    font-size: 0.9em;
  }
  
  .logo {
    width: 50px;
    height: 50px;
  }
  
  .quick-start-card {
    padding: 12px;
    min-height: 90px;
  }
  
  .card-icon {
    font-size: 1.6em;
  }
  
  .card-title {
    font-size: 0.9em;
  }
  
  .card-description {
    font-size: 0.75em;
  }
  
  .welcome-input-wrapper {
    padding: 10px 12px;
  }
  
  .welcome-send-btn {
    min-width: 120px;
    padding: 12px 20px;
    font-size: 14px;
  }
  
  .message-bubble {
    max-width: 90%;
    padding: 10px 12px;
  }
  
  .message-content {
    font-size: 13px;
  }
}

/* Ê®™Â±èÊ®°Âºè‰ºòÂåñ */
@media (max-width: 768px) and (orientation: landscape) {
  .welcome-screen {
    padding: 12px 15px;
  }
  
  .logo-section {
    margin-bottom: 20px;
  }
  
  .title {
    font-size: 1.6em;
  }
  
  .subtitle {
    font-size: 0.9em;
  }
  
  .logo {
    width: 50px;
    height: 50px;
    margin-bottom: 8px;
  }
  
  .quick-start-cards {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 20px;
    margin-bottom: 20px;
  }
  
  .quick-start-card {
    padding: 12px;
    min-height: auto;
  }
  
  .card-icon {
    font-size: 1.5em;
  }
  
  .welcome-input-section {
    margin-top: 20px;
  }
  
  .chat-interface {
    height: calc(100vh - 8px);
  }
}

/* Èò≤Ê≠¢Áº©ÊîæÂíåÊîπÂñÑËß¶Êë∏‰ΩìÈ™å */
@media (max-width: 768px) {
  /* Èò≤Ê≠¢ÂèåÂáªÁº©Êîæ */
  .quick-start-card,
  .welcome-send-btn,
  .send-btn {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* ÊîπÂñÑÊªöÂä®ÊÄßËÉΩ */
  .messages-list {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  /* ‰ºòÂåñËæìÂÖ•Ê°Ü‰ΩìÈ™å */
  .welcome-message-input,
  .message-input {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border-radius: 0;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* ‰ºòÂåñÊåâÈíÆÁÇπÂáªÂèçÈ¶à */
  .quick-start-card:active {
    transform: translateY(-2px) scale(0.98);
    transition-duration: 0.1s;
  }
  
  .welcome-send-btn:active,
  .send-btn:active {
    transform: scale(0.95);
    transition-duration: 0.1s;
  }
  
  /* Èò≤Ê≠¢iOS SafariÂ∫ïÈÉ®Â∑•ÂÖ∑Ê†èÂΩ±Âìç */
  .chat-interface {
    min-height: calc(100vh - 16px);
    min-height: calc(100dvh - 16px); /* Âä®ÊÄÅËßÜÂè£È´òÂ∫¶ */
  }
  
  .messages-container {
    height: calc(100vh - 40px);
    height: calc(100dvh - 40px); /* Âä®ÊÄÅËßÜÂè£È´òÂ∫¶ */
  }
}

/* iOS ÁâπÊÆä‰ºòÂåñ */
@supports (-webkit-touch-callout: none) {
  .welcome-message-input,
  .message-input {
    /* Á¶ÅÁî®iOSÁöÑËá™Âä®Áº©Êîæ */
    -webkit-text-size-adjust: 100%;
    font-size: 16px !important; /* Èò≤Ê≠¢iOSÁº©Êîæ */
  }
  
  /* iOSÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç */
  .chat-interface {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
  
  /* iOSÈîÆÁõòÂºπÂá∫‰ºòÂåñ */
  @media (max-width: 768px) {
    .input-container {
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    
    .welcome-input-section {
      padding-bottom: env(safe-area-inset-bottom);
    }
  }
}

/* Android ÁâπÊÆä‰ºòÂåñ */
@media (max-width: 768px) {
  /* Android ChromeÂú∞ÂùÄÊ†èÈöêËóèÈÄÇÈÖç */
  .chat-interface {
    min-height: -webkit-fill-available;
  }
  
  /* ‰ºòÂåñAndroidÈîÆÁõò‰ΩìÈ™å */
  .welcome-message-input:focus,
  .message-input:focus {
    transform: translateZ(0); /* Âº∫Âà∂Á°¨‰ª∂Âä†ÈÄü */
  }
}

/* PWAÂíåÂÖ®Â±èÊ®°Âºè‰ºòÂåñ */
@media (display-mode: standalone) {
  .chat-interface {
    height: 100vh;
    margin: 0;
    border-radius: 0;
  }
  
  .welcome-screen {
    padding-top: calc(20px + env(safe-area-inset-top));
  }
}

/* È´òDPIÂ±èÂπï‰ºòÂåñ */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .logo {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
  
  .card-icon {
    text-rendering: optimizeLegibility;
  }
}

/* ÂáèÂ∞ëÂä®Áîª‰ª•ËäÇÁúÅÁîµÊ±†ÔºàÁî®Êà∑ÂÅèÂ•ΩÔºâ */
@media (prefers-reduced-motion: reduce) {
  .quick-start-card,
  .welcome-send-btn,
  .send-btn,
  .message-bubble,
  .thinking-dots .dot {
    animation: none !important;
    transition: none !important;
  }
  
  .quick-start-card:hover,
  .welcome-send-btn:hover,
  .send-btn:hover {
    transform: none !important;
  }
}

/* Ê∑±Ëâ≤Ê®°ÂºèÈÄÇÈÖç */
@media (prefers-color-scheme: dark) {
  @media (max-width: 768px) {
    .welcome-screen {
      background: linear-gradient(135deg, 
        rgba(45, 55, 72, 0.9) 0%, 
        rgba(55, 65, 81, 0.9) 50%, 
        rgba(75, 85, 99, 0.9) 100%
      );
    }
    
    .quick-start-card {
      background: rgba(45, 55, 72, 0.95);
      border-color: rgba(108, 99, 255, 0.3);
      color: #F7FAFC;
    }
    
    .card-title {
      color: #F7FAFC;
    }
    
    .card-description {
      color: #CBD5E0;
    }
    
    .welcome-input-wrapper,
    .input-wrapper {
      background: rgba(45, 55, 72, 0.9);
      border-color: rgba(108, 99, 255, 0.3);
    }
    
    .welcome-message-input,
    .message-input {
      color: #F7FAFC;
    }
    
    .welcome-message-input::placeholder,
    .message-input::placeholder {
      color: #A0AEC0;
    }
    
    .message-wrapper.assistant .message-bubble {
      background: rgba(45, 55, 72, 0.95);
      color: #F7FAFC;
      border-color: rgba(108, 99, 255, 0.2);
    }
    
    .tools-status,
    .welcome-tools-status {
      background: rgba(45, 55, 72, 0.8);
      border-color: rgba(108, 99, 255, 0.2);
    }
    
    .thinking-indicator {
      background: rgba(45, 55, 72, 0.9);
      color: #F7FAFC;
      border-color: rgba(108, 99, 255, 0.2);
    }
  }
}

/* Êñ∞Â¢ûÁßëÊäÄÊÑüÊ†∑Âºè */
.title-gradient {
  background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 50%, #91EAE4 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientShift 3s ease-in-out infinite;
}

@keyframes gradientShift {
  0%, 100% { filter: hue-rotate(0deg); }
  50% { filter: hue-rotate(15deg); }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card-background {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  border-radius: inherit;
  opacity: 0;
  transition: all 0.3s ease;
}

.feature-card:hover .card-background {
  opacity: 1;
}

.card-hover-effect {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(108, 99, 255, 0.1) 0%, rgba(134, 168, 231, 0.1) 100%);
  border-radius: inherit;
  opacity: 0;
  transition: all 0.3s ease;
}

.feature-card:hover .card-hover-effect {
  opacity: 1;
}

.send-content {
  display: flex;
  align-items: center;
  gap: 6px;
}

.send-text {
  font-weight: 600;
}

.send-icon {
  font-size: 18px;
  transition: transform 0.3s ease;
}

.send-button:hover .send-icon {
  transform: translateX(2px);
}

.loading-spinner {
  display: flex;
  align-items: center;
  justify-content: center;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.mini-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ‰ºòÂåñÂêéÁöÑÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .chat-interface {
    margin: 0;
    height: 100vh;
    border-radius: 0;
    overflow-x: hidden;
  }

  .welcome-screen {
    padding: 16px;
    min-height: 100vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .welcome-content {
    padding: 20px 0;
    max-width: 100%;
    min-height: calc(100vh - 40px);
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }

  .hero-section {
    margin-bottom: 24px;
    text-align: center;
  }

  .logo-container {
    margin-bottom: 16px;
  }

  .logo {
    width: 80px;
    height: 80px;
  }

  .main-title {
    font-size: 2em;
    margin-bottom: 8px;
    line-height: 1.2;
  }

  .subtitle {
    font-size: 1em;
    margin-bottom: 0;
  }

  .features-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }

  .feature-card {
    padding: 16px 12px;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    justify-content: center;
  }

  .card-icon {
    font-size: 1.8em;
    margin-bottom: 8px;
  }

  .card-title {
    font-size: 14px;
    margin-bottom: 4px;
  }

  .card-description {
    font-size: 11px;
    line-height: 1.3;
  }

  .control-panel {
    margin: 16px 0;
    padding: 16px;
    border-radius: 16px;
  }

  .section-header {
    margin-bottom: 10px;
  }

  .section-title {
    font-size: 13px;
  }

  .modern-selector {
    padding: 12px 14px;
    padding-right: 40px;
    font-size: 14px;
    border-radius: 12px;
  }

  .tools-grid {
    gap: 6px;
    justify-content: flex-start;
  }

  .tool-chip {
    font-size: 11px;
    padding: 4px 8px;
  }

  .input-section {
    margin-top: 20px;
    margin-bottom: 20px;
  }

  .input-card {
    padding: 16px;
    gap: 12px;
    border-radius: 16px;
  }

  .main-input {
    font-size: 16px;
    padding: 14px 0;
    line-height: 1.4;
    min-height: 22px;
  }

  .send-button {
    padding: 12px 16px;
    font-size: 14px;
    border-radius: 12px;
    min-width: 70px;
  }

  /* ËÅäÂ§©ÁïåÈù¢ÁßªÂä®Á´Ø‰ºòÂåñ */
  .messages-container {
    padding-bottom: 20px;
  }

  .messages-list {
    padding: 16px;
  }

  .message-bubble {
    max-width: 85%;
    padding: 12px 16px;
    font-size: 15px;
    border-radius: 16px;
  }

  .chat-input-container {
    padding: 16px;
    background: var(--surface-color);
    border-top: 1px solid var(--border-color);
  }

  .chat-input-card {
    padding: 12px 16px;
    gap: 12px;
    border-radius: 16px;
  }

  .chat-input {
    font-size: 16px;
    padding: 12px 0;
    line-height: 1.4;
  }

  .chat-send-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
  }

  .chat-toolbar {
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
    margin-bottom: 12px;
  }

  .chat-model-selector,
  .chat-tools-status {
    padding: 10px 12px;
    border-radius: 10px;
    font-size: 13px;
  }

  .tools-chips {
    justify-content: flex-start;
    flex-wrap: wrap;
  }

  .tool-chip {
    font-size: 11px;
    padding: 3px 8px;
  }
}

@media (max-width: 480px) {
  .welcome-screen {
    padding: 12px;
  }

  .welcome-content {
    padding: 16px 0;
    min-height: calc(100vh - 32px);
  }

  .hero-section {
    margin-bottom: 20px;
  }

  .logo {
    width: 70px;
    height: 70px;
  }

  .main-title {
    font-size: 1.8em;
    margin-bottom: 6px;
  }

  .subtitle {
    font-size: 0.9em;
  }

  .features-grid {
    grid-template-columns: 1fr;
    gap: 10px;
    margin-bottom: 20px;
  }

  .feature-card {
    padding: 14px 10px;
    min-height: 80px;
    flex-direction: row;
    text-align: left;
    align-items: center;
    justify-content: flex-start;
  }

  .card-icon {
    font-size: 1.6em;
    margin-bottom: 0;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .card-content {
    flex: 1;
  }

  .card-title {
    font-size: 13px;
    margin-bottom: 2px;
  }

  .card-description {
    font-size: 10px;
    line-height: 1.2;
  }

  .control-panel {
    margin: 12px 0;
    padding: 14px;
    border-radius: 14px;
  }

  .control-section {
    margin-bottom: 14px;
  }

  .section-header {
    margin-bottom: 8px;
  }

  .section-title {
    font-size: 12px;
  }

  .modern-selector {
    padding: 11px 13px;
    padding-right: 35px;
    font-size: 13px;
    border-radius: 10px;
  }

  .tools-grid {
    gap: 4px;
  }

  .tool-chip {
    font-size: 10px;
    padding: 3px 6px;
    border-radius: 8px;
  }

  /* Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°ÁßªÂä®Á´ØÊ†∑Âºè */
  .example-bubbles {
    margin-bottom: 14px;
  }

  .bubbles-label {
    font-size: 13px;
    margin-bottom: 10px;
  }

  .bubbles-container {
    gap: 8px;
  }

  .example-bubble {
    padding: 6px 10px;
    font-size: 12px;
    border-radius: 16px;
  }

  .bubble-icon {
    font-size: 12px;
  }

  .bubble-text {
    font-size: 12px;
  }

  .chat-example-bubbles {
    padding: 0 12px 10px 12px;
  }

  .chat-bubbles-container {
    gap: 6px;
  }

  .chat-example-bubble {
    padding: 5px 8px;
    border-radius: 14px;
  }

  .chat-bubble-icon {
    font-size: 11px;
  }

  .chat-bubble-text {
    font-size: 10px;
  }

  .input-section {
    margin-top: 20px;
    margin-bottom: 20px;
    animation: mobileInputGlow 2.5s ease-in-out infinite alternate;
  }

  @keyframes mobileInputGlow {
    0% {
      filter: drop-shadow(0 0 12px rgba(108, 99, 255, 0.4));
    }
    100% {
      filter: drop-shadow(0 0 20px rgba(108, 99, 255, 0.6));
    }
  }

  .input-card {
    padding: 20px 24px;
    gap: 12px;
    border-radius: 20px;
    border: 2px solid rgba(108, 99, 255, 0.25);
    animation: mobileCardPulse 3.5s ease-in-out infinite;
  }

  @keyframes mobileCardPulse {
    0%, 100% {
      transform: translateY(0px) scale(1);
      box-shadow: 
        0 15px 45px rgba(108, 99, 255, 0.2),
        0 5px 18px rgba(108, 99, 255, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
    }
    50% {
      transform: translateY(-3px) scale(1.015);
      box-shadow: 
        0 20px 55px rgba(108, 99, 255, 0.25),
        0 8px 25px rgba(108, 99, 255, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.95);
    }
  }

  .main-input {
    font-size: 16px;
    padding: 12px 0;
    line-height: 1.3;
    min-height: 20px;
  }

  .send-button {
    padding: 10px 12px;
    font-size: 13px;
    border-radius: 10px;
    min-width: 60px;
  }

  .send-text {
    display: none;
  }

  /* ËÅäÂ§©ÁïåÈù¢Â∞èÂ±è‰ºòÂåñ */
  .messages-list {
    padding: 12px;
  }

  .message-bubble {
    max-width: 90%;
    padding: 10px 14px;
    font-size: 14px;
    border-radius: 14px;
  }

  .chat-input-container {
    padding: 12px;
  }

  .chat-input-card {
    padding: 10px 14px;
    gap: 10px;
    border-radius: 14px;
  }

  .chat-input {
    font-size: 16px;
    padding: 10px 0;
    line-height: 1.3;
  }

  .chat-send-btn {
    width: 36px;
    height: 36px;
  }

  .chat-toolbar {
    gap: 8px;
    margin-bottom: 10px;
  }

  .chat-model-selector,
  .chat-tools-status {
    padding: 8px 10px;
    border-radius: 8px;
    font-size: 12px;
  }

  .tool-chip {
    font-size: 10px;
    padding: 2px 6px;
  }
}

/* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
@media (max-width: 320px) {
  .welcome-screen {
    padding: 8px;
  }

  .welcome-content {
    padding: 12px 0;
    min-height: calc(100vh - 20px);
  }

  .hero-section {
    margin-bottom: 16px;
  }

  .logo {
    width: 60px;
    height: 60px;
  }

  .main-title {
    font-size: 1.6em;
    margin-bottom: 4px;
  }

  .subtitle {
    font-size: 0.85em;
  }

  .features-grid {
    gap: 8px;
    margin-bottom: 16px;
  }

  .feature-card {
    padding: 10px 8px;
    min-height: 70px;
  }

  .card-icon {
    font-size: 1.4em;
    margin-right: 10px;
  }

  .card-title {
    font-size: 12px;
    margin-bottom: 1px;
  }

  .card-description {
    font-size: 9px;
  }

  .control-panel {
    margin: 10px 0;
    padding: 12px;
    border-radius: 12px;
  }

  .control-section {
    margin-bottom: 12px;
  }

  .section-header {
    margin-bottom: 6px;
  }

  .section-title {
    font-size: 11px;
  }

  .modern-selector {
    padding: 10px 12px;
    padding-right: 32px;
    font-size: 12px;
    border-radius: 8px;
  }

  .tools-grid {
    gap: 3px;
  }

  .tool-chip {
    font-size: 9px;
    padding: 2px 5px;
    border-radius: 6px;
  }

  /* Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°Ë∂ÖÂ∞èÂ±èÊ†∑Âºè */
  .example-bubbles {
    margin-bottom: 12px;
  }

  .bubbles-label {
    font-size: 12px;
    margin-bottom: 8px;
  }

  .bubbles-container {
    gap: 6px;
  }

  .example-bubble {
    padding: 5px 8px;
    font-size: 11px;
    border-radius: 14px;
  }

  .bubble-icon {
    font-size: 11px;
  }

  .bubble-text {
    font-size: 11px;
  }

  .chat-example-bubbles {
    padding: 0 8px 8px 8px;
  }

  .chat-bubbles-container {
    gap: 4px;
  }

  .chat-example-bubble {
    padding: 4px 6px;
    border-radius: 12px;
  }

  .chat-bubble-icon {
    font-size: 10px;
  }

  .chat-bubble-text {
    font-size: 9px;
  }

  .input-section {
    margin-top: 12px;
    margin-bottom: 12px;
  }

  .input-card {
    padding: 10px;
    gap: 8px;
    border-radius: 12px;
  }

  .main-input {
    font-size: 16px;
    padding: 10px 0;
    line-height: 1.2;
  }

  .send-button {
    padding: 8px 10px;
    font-size: 12px;
    border-radius: 8px;
    min-width: 50px;
  }

  /* ËÅäÂ§©ÁïåÈù¢Ë∂ÖÂ∞èÂ±è‰ºòÂåñ */
  .messages-list {
    padding: 8px;
  }

  .message-bubble {
    max-width: 95%;
    padding: 8px 12px;
    font-size: 13px;
    border-radius: 12px;
  }

  .chat-input-container {
    padding: 8px;
  }

  .chat-input-card {
    padding: 8px 12px;
    gap: 8px;
    border-radius: 12px;
  }

  .chat-input {
    font-size: 16px;
    padding: 8px 0;
  }

  .chat-send-btn {
    width: 32px;
    height: 32px;
  }

  .chat-toolbar {
    gap: 6px;
    margin-bottom: 8px;
  }

  .chat-model-selector,
  .chat-tools-status {
    padding: 6px 8px;
    border-radius: 6px;
    font-size: 11px;
  }
}

/* È´òÂàÜËæ®ÁéáÂ±èÂπï‰ºòÂåñ */
@media (min-width: 1200px) {
  .welcome-content {
    max-width: 900px;
  }

  .features-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
  }

  .feature-card {
    flex-direction: column;
    text-align: center;
    padding: 30px 20px;
  }

  .card-icon-wrapper {
    margin-bottom: 16px;
  }

  .card-icon {
    font-size: 3em;
  }
}

/* ÊöóËâ≤‰∏ªÈ¢òÈÄÇÈÖç */
@media (prefers-color-scheme: dark) {
  .tech-background .gradient-orb {
    opacity: 0.05;
  }

  .feature-card {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .feature-card:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(108, 99, 255, 0.3);
  }

  .control-panel,
  .input-card {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .main-input::placeholder,
.chat-input::placeholder {
  color: #bbb !important;
}
}

/* Âä®ÁîªÊÄßËÉΩ‰ºòÂåñ */
@media (prefers-reduced-motion: reduce) {
  .gradient-orb,
  .tech-grid,
  .hero-section,
  .feature-card {
    animation: none;
  }

  .feature-card {
    animation-delay: 0s;
  }

  .title-gradient {
    animation: none;
    background: linear-gradient(135deg, #6C63FF 0%, #86A8E7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
}

/* Êó†ÈöúÁ¢çËÆøÈóÆ‰ºòÂåñ */
@media (prefers-contrast: high) {
  .feature-card {
    border-width: 2px;
    border-color: var(--text-primary);
  }

  .card-title,
  .card-description {
    color: var(--text-primary);
  }

  .tool-chip {
    border: 2px solid var(--primary-color);
  }
}

/* iOSÂíåAndroidÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç */
@supports (padding: max(0px)) {
  @media (max-width: 768px) {
    .chat-interface {
      height: 100vh;
      height: 100dvh; /* Âä®ÊÄÅËßÜÂè£È´òÂ∫¶ */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    .welcome-screen {
      padding-top: max(16px, env(safe-area-inset-top));
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      min-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      min-height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }
    
    .chat-input-container {
      padding-bottom: max(16px, env(safe-area-inset-bottom));
    }
    
    /* ÈîÆÁõòÂºπËµ∑Êó∂ÁöÑÈÄÇÈÖç */
    .chat-interface.keyboard-open {
      height: 100vh;
      height: 100svh; /* Â∞èËßÜÂè£È´òÂ∫¶ÔºåÈîÆÁõòÂºπËµ∑Êó∂‰ΩøÁî® */
    }
  }
  
  @media (max-width: 480px) {
    .welcome-screen {
      padding-top: max(12px, env(safe-area-inset-top));
      padding-bottom: max(12px, env(safe-area-inset-bottom));
    }
    
    .chat-input-container {
      padding-bottom: max(12px, env(safe-area-inset-bottom));
    }
    
    .input-section {
      margin-bottom: max(16px, env(safe-area-inset-bottom));
    }
  }
  
  @media (max-width: 320px) {
    .welcome-screen {
      padding-top: max(8px, env(safe-area-inset-top));
      padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
    
    .chat-input-container {
      padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
    
    .input-section {
      margin-bottom: max(12px, env(safe-area-inset-bottom));
    }
  }
}

/* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
@media (hover: none) and (pointer: coarse) {
  .feature-card,
  .control-panel,
  .input-card,
  .send-button,
  .modern-selector,
  .example-bubble,
  .chat-example-bubble {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  
  .feature-card:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }

  .example-bubble:active,
  .chat-example-bubble:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
  }
  
  .send-button:active,
  .chat-send-btn:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
  }
  
  /* Á°Æ‰øùËæìÂÖ•Ê°ÜÂú®iOS‰∏äÊ≠£Á°ÆÊòæÁ§∫ */
  .main-input,
  .chat-input {
    -webkit-appearance: none;
    border-radius: 0;
  }
}
/* ÈõÜÊàêËæìÂÖ•Ê°ÜÊ†∑Âºè - Ê¨¢ËøéÁïåÈù¢ */
.input-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  max-width: 900px;
  width: 100%;
  margin: 30px auto 0;
}

.integrated-input-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(108, 99, 255, 0.15);
  border-radius: 24px;
  box-shadow: 
    0 20px 40px rgba(108, 99, 255, 0.1),
    0 8px 32px rgba(0, 0, 0, 0.05);
  padding: 24px;
  width: 100%;
  max-width: 700px;
  margin: 0 auto;
  transition: all 0.3s ease;
}

.integrated-input-card:hover {
  border-color: rgba(108, 99, 255, 0.25);
  box-shadow: 
    0 25px 50px rgba(108, 99, 255, 0.15),
    0 12px 40px rgba(0, 0, 0, 0.08);
}

/* AIÊ®°ÂûãÈÄâÊã©Âå∫Âüü */
.input-model-section {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
  padding: 16px 20px;
  background: linear-gradient(135deg, rgba(108, 99, 255, 0.05) 0%, rgba(134, 168, 231, 0.05) 100%);
  border: 1px solid rgba(108, 99, 255, 0.1);
  border-radius: 16px;
}

.model-header {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 100px;
}

.model-icon {
  font-size: 20px;
  color: var(--primary-color);
}

.model-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 14px;
}

.model-selector-wrapper {
  position: relative;
  flex: 1;
}

.integrated-model-selector {
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(108, 99, 255, 0.2);
  border-radius: 12px;
  padding: 12px 40px 12px 16px;
  font-size: 14px;
  color: var(--text-primary);
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  appearance: none;
}

.integrated-model-selector:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
}

.selector-chevron {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
  pointer-events: none;
}

/* Êô∫ËÉΩÂ∑•ÂÖ∑Âå∫Âüü */
.input-tools-section {
  margin-bottom: 20px;
  padding: 16px 20px;
  background: linear-gradient(135deg, rgba(134, 168, 231, 0.05) 0%, rgba(108, 99, 255, 0.05) 100%);
  border: 1px solid rgba(134, 168, 231, 0.1);
  border-radius: 16px;
}

.tools-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.tools-icon {
  font-size: 18px;
  color: var(--secondary-color);
}

.tools-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 14px;
}

.tools-count {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: auto;
}

.input-tools-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.input-tool-chip {
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(134, 168, 231, 0.2);
  color: var(--text-primary);
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.input-tool-chip:hover {
  background: rgba(134, 168, 231, 0.1);
  border-color: var(--secondary-color);
}

.more-tools-chip {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  border: none;
}

/* ÂØπËØùÁïåÈù¢ÈõÜÊàêËæìÂÖ•Ê°ÜÊ†∑Âºè */
.chat-input-container {
  padding: 16px 20px 20px;
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.95) 0%, 
    rgba(248, 250, 252, 0.95) 100%);
  backdrop-filter: blur(20px);
  border-top: 1px solid rgba(108, 99, 255, 0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
  position: sticky;
  bottom: 0;
  z-index: 10;
  box-shadow: 0 -4px 20px rgba(108, 99, 255, 0.08);
}

.chat-integrated-input-card {
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.98) 0%, 
    rgba(255, 255, 255, 0.95) 100%);
  backdrop-filter: blur(30px);
  border: 2px solid rgba(108, 99, 255, 0.15);
  border-radius: 24px;
  box-shadow: 
    0 20px 40px rgba(108, 99, 255, 0.1),
    0 8px 32px rgba(0, 0, 0, 0.05),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  padding: 24px;
  width: 100%;
  max-width: 650px;
  margin: 0 auto;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.chat-integrated-input-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(108, 99, 255, 0.05), 
    transparent
  );
  transition: left 0.6s ease;
  pointer-events: none;
}

.chat-integrated-input-card:hover::before {
  left: 100%;
}

.chat-integrated-input-card:hover {
  border-color: rgba(108, 99, 255, 0.3);
  box-shadow: 
    0 25px 50px rgba(108, 99, 255, 0.15),
    0 12px 40px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  transform: translateY(-2px);
}

/* AIÂ§ßËÑëÂíåÊô∫ËÉΩÂ∑•ÂÖ∑Ê∞¥Âπ≥ÊéíÂàóÂÆπÂô® */
.chat-controls-row {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
  align-items: flex-start;
}

/* ÂØπËØùÁïåÈù¢Ê®°ÂûãÈÄâÊã©Âå∫Âüü */
.chat-model-section {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: linear-gradient(135deg, rgba(108, 99, 255, 0.04) 0%, rgba(134, 168, 231, 0.04) 100%);
  border: 1px solid rgba(108, 99, 255, 0.08);
  border-radius: 12px;
  flex: 1;
  min-width: 0;
}

.chat-model-header {
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 80px;
}

.chat-model-icon {
  font-size: 16px;
  color: var(--primary-color);
}

.chat-model-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 13px;
}

.chat-model-wrapper {
  position: relative;
  flex: 1;
}

.chat-model-selector {
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(108, 99, 255, 0.15);
  border-radius: 10px;
  padding: 10px 32px 10px 12px;
  font-size: 13px;
  color: var(--text-primary);
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  appearance: none;
}

.chat-model-selector:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.08);
}

.chat-selector-chevron {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
  pointer-events: none;
}

/* ÂØπËØùÁïåÈù¢Â∑•ÂÖ∑Âå∫Âüü */
.chat-tools-section {
  padding: 12px 16px;
  background: linear-gradient(135deg, rgba(134, 168, 231, 0.04) 0%, rgba(108, 99, 255, 0.04) 100%);
  border: 1px solid rgba(134, 168, 231, 0.08);
  border-radius: 12px;
  flex: 1;
  min-width: 0;
}

.chat-tools-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 8px;
}

.chat-tools-icon {
  font-size: 16px;
  color: var(--secondary-color);
}

.chat-tools-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 13px;
}

.chat-tools-count {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  font-size: 11px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 8px;
  margin-left: auto;
}

.chat-tools-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.chat-tool-chip {
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(134, 168, 231, 0.15);
  color: var(--text-primary);
  padding: 4px 10px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.chat-tool-chip:hover {
  background: rgba(134, 168, 231, 0.08);
  border-color: var(--secondary-color);
}

.chat-more-chip {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  border: none;
}

/* Êé®Ëçê‰æãÂ≠êÊ∞îÊ≥°Ê†∑ÂºèË∞ÉÊï¥ */
.chat-example-bubbles {
  margin-bottom: 16px;
  max-width: 600px;
  width: 100%;
}

.chat-bubbles-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.chat-example-bubble {
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(108, 99, 255, 0.1);
  color: var(--text-primary);
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.chat-example-bubble:hover {
  background: rgba(108, 99, 255, 0.08);
  border-color: var(--primary-color);
  transform: translateY(-1px);
}

.chat-bubble-icon {
  font-size: 14px;
}

.chat-bubble-text {
  font-weight: 500;
}

/* ÁßªÂä®Á´ØÈÄÇÈÖç */
@media (max-width: 768px) {
  .integrated-input-card,
  .chat-integrated-input-card {
    margin: 0 16px;
    padding: 20px;
    border-radius: 20px;
  }
  
  /* ÁßªÂä®Á´ØÊ∞¥Âπ≥Â∏ÉÂ±ÄÊîπ‰∏∫ÂûÇÁõ¥ */
  .chat-controls-row {
    flex-direction: column;
    gap: 12px;
  }
  
  .input-model-section,
  .chat-model-section {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .model-header,
  .chat-model-header {
    justify-content: center;
    min-width: auto;
  }
  
  .input-tools-section,
  .chat-tools-section {
    padding: 16px;
  }
  
  .input-tools-grid,
  .chat-tools-chips {
    justify-content: center;
  }
}

@media (max-width: 480px) {
  .integrated-input-card,
  .chat-integrated-input-card {
    margin: 0 12px;
    padding: 16px;
    border-radius: 16px;
  }
  
  .input-model-section,
  .chat-model-section,
  .input-tools-section,
  .chat-tools-section {
    padding: 12px;
    border-radius: 12px;
  }
  
  .input-tool-chip,
  .chat-tool-chip {
    font-size: 12px;
    padding: 4px 8px;
  }
}

</style> 